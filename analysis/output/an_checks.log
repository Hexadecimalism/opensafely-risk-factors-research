-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/app/notebook/analysis/output/an_checks.log
  log type:  text
 opened on:  19 Apr 2020, 17:27:31

. 
. * Open Stata dataset
. use egdata, clear
(Poor factors dummy analysis dataset)

. 
. 
. 
. ******************************************
. *  Check variables take expected values  *
. ******************************************
. 
. * Age
. assert age<.

. *assert inrange(age, 18, 105)
. assert inlist(agegroup, 1, 2, 3, 4, 5, 6)

. assert inlist(age70, 0, 1)

. 
. * Sex
. assert inlist(male, 0, 1)

. 
. * BMI 
. * assert inrange(bmi, 10, 200) | bmi==.
. assert inlist(obese40, 0, 1)

. assert inlist(bmicat, 1, 2, 3, 4, 5, 6, .u)

. 
. * IMD
. assert inlist(imd, 1, 2, 3, 4, 5, .u)

. 
. * Ethnicity
. assert inlist(ethnicity, 1, 2, 3, 4, 5, .u)

. 
. * Smoking
. assert inlist(smoke, 1, 2, 3, .u)

. assert inlist(currentsmoke, 0, 1)

. 
. * Blood pressure
. assert inlist(bpcat, 1, 2, 3, 4, .u)

. 
. 
. 
. ***************************************
. *  Cross-check logical relationships  *
. ***************************************
. 
. 
. * BMI
. bysort bmicat: summ bmi

-------------------------------------------------------------------------------
-> bmicat = Underweight (<18.5)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |      8,955    16.79125    1.005214   15.00064   18.49998

-------------------------------------------------------------------------------
-> bmicat = Normal (18.5-24.9)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |     21,059    21.86931    1.868461   18.50021   24.99989

-------------------------------------------------------------------------------
-> bmicat = Overweight (25-29.9)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |     18,485    27.53327    1.440013   25.00008   29.99987

-------------------------------------------------------------------------------
-> bmicat = Obese I (30-34.9)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |     18,250    32.46709    1.430246   30.00027   34.99982

-------------------------------------------------------------------------------
-> bmicat = Obese II (35-39.9)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |     16,530    37.43394    1.432497         35   39.99957

-------------------------------------------------------------------------------
-> bmicat = Obese III (40+)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |     22,600    44.45362    2.842998   40.00008    49.9991

-------------------------------------------------------------------------------
-> bmicat = Unknown (.u)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         bmi |          0


. tab bmicat obese40, m

                     |  Severely obese (cat
                     |          3)
         Grouped BMI |         0          1 |     Total
---------------------+----------------------+----------
 Underweight (<18.5) |     8,955          0 |     8,955 
  Normal (18.5-24.9) |    21,059          0 |    21,059 
Overweight (25-29.9) |    18,485          0 |    18,485 
   Obese I (30-34.9) |    18,250          0 |    18,250 
  Obese II (35-39.9) |    16,530          0 |    16,530 
     Obese III (40+) |         0     22,600 |    22,600 
        Unknown (.u) |    35,631          0 |    35,631 
---------------------+----------------------+----------
               Total |   118,910     22,600 |   141,510 

. 
. * Age
. bysort agegroup: summ age

-------------------------------------------------------------------------------
-> agegroup = 18-<40

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     35,665    28.03188    6.658915         18         39

-------------------------------------------------------------------------------
-> agegroup = 40-<50

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     27,420    44.96853    2.790285         40         49

-------------------------------------------------------------------------------
-> agegroup = 50-<60

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     29,777    54.55597    2.338733         50         59

-------------------------------------------------------------------------------
-> agegroup = 60-<70

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     14,464      64.416    2.881081         60         69

-------------------------------------------------------------------------------
-> agegroup = 70-<80

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     11,763      73.907     2.71503         70         79

-------------------------------------------------------------------------------
-> agegroup = 80+

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |     22,421    89.36524    5.470732         80        105


. tab agegroup age70, m

   Grouped |  70 years and older
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,665          0 |    35,665 
    40-<50 |    27,420          0 |    27,420 
    50-<60 |    29,777          0 |    29,777 
    60-<70 |    14,464          0 |    14,464 
    70-<80 |         0     11,763 |    11,763 
       80+ |         0     22,421 |    22,421 
-----------+----------------------+----------
     Total |   107,326     34,184 |   141,510 

. 
. * Smoking
. tab smoke currentsmoke, m

     Smoking |    Current smoker
      status |         0          1 |     Total
-------------+----------------------+----------
       Never |    42,649          0 |    42,649 
      Former |    59,419          0 |    59,419 
     Current |         0     23,683 |    23,683 
Unknown (.u) |    15,759          0 |    15,759 
-------------+----------------------+----------
       Total |   117,827     23,683 |   141,510 

. 
. 
. 
. *********************
. *  Summarise dates  *
. *********************
. 
. * BMI
. summ bmi_date_measured, format

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bmi_date_m~d |     33,331   21jan2017    203.5783  15feb2010  15jul2030

. 
. * Dates of comorbidities  
. foreach var of varlist  chronic_respiratory_disease     ///
>                                                 chronic_cardiac_disease      
>            ///
>                                                 diabetes                     
>                            ///
>                                                 lung_cancer                  
>                    ///
>                                                 haem_cancer                  
>                            ///
>                                                 other_cancer                 
>                    ///
>                                                 bone_marrow_transplant       
>            ///
>                                                 chemo_radio_therapy          
>            ///
>                                                 chronic_liver_disease        
>            ///
>                                                 neurological_condition       
>            ///
>                                                 chronic_kidney_disease       
>            ///
>                                                 organ_transplant             
>                    ///     
>                                                 dysplenia                    
>                            ///
>                                                 sickle_cell                  
>                    ///
>                                                 ra_sle_psoriasis  {
  2. 
.         summ `var'_date, format
  3.         bysort `var': summ `var'_date
  4. }

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_r~te |        919   14mar1992    7914.777  15jan1900  15jun2019

-------------------------------------------------------------------------------
-> chronic_respiratory_disease = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_r~te |          0

-------------------------------------------------------------------------------
-> chronic_respiratory_disease = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_r~te |        919    11761.66    7914.777     -21900      21715


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_c~te |     22,880   10jun1992    5683.039  15jan1900  15mar2020

-------------------------------------------------------------------------------
-> chronic_cardiac_disease = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_c~te |          1       21989           .      21989      21989

-------------------------------------------------------------------------------
-> chronic_cardiac_disease = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_c~te |     22,879     11848.8    5682.768     -21900      21623


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
diabetes_d~e |     42,060   01nov2001    6746.082  15jan1900  15apr2020

-------------------------------------------------------------------------------
-> diabetes = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
diabetes_d~e |         31       21994    11.59023      21989      22020

-------------------------------------------------------------------------------
-> diabetes = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
diabetes_d~e |     42,029    15275.63    6746.105     -21900      21929


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
lung_cance~e |         34   28feb2002    2055.794  15nov1993  15feb2019

-------------------------------------------------------------------------------
-> lung_cancer = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
lung_cance~e |          0

-------------------------------------------------------------------------------
-> lung_cancer = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
lung_cance~e |         34    15399.91    2055.794      12372      21595


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
haem_cance~e |     10,154   31may2000    809.4732  15jan1900  15dec2019

-------------------------------------------------------------------------------
-> haem_cancer = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
haem_cance~e |          0

-------------------------------------------------------------------------------
-> haem_cancer = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
haem_cance~e |     10,154    14761.19    809.4732     -21900      21898


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
other_canc~e |        757   12sep1993    7711.548  15jan1900  15dec2019

-------------------------------------------------------------------------------
-> other_cancer = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
other_canc~e |          0

-------------------------------------------------------------------------------
-> other_cancer = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
other_canc~e |        757    12308.78    7711.548     -21900      21898


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bone_marro~e |          1   15mar2003           .  15mar2003  15mar2003

-------------------------------------------------------------------------------
-> bone_marrow_transplant = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bone_marro~e |          0

-------------------------------------------------------------------------------
-> bone_marrow_transplant = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bone_marro~e |          1       15779           .      15779      15779


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chemo_radi~e |         84   03jun1991    7468.811  15jan1900  15feb2012

-------------------------------------------------------------------------------
-> chemo_radio_therapy = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chemo_radi~e |          0

-------------------------------------------------------------------------------
-> chemo_radio_therapy = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chemo_radi~e |         84    11476.07    7468.811     -21900      19038


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_l~te |     10,073   17aug1999     875.676  15jan1900  15sep2017

-------------------------------------------------------------------------------
-> chronic_liver_disease = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_l~te |          0

-------------------------------------------------------------------------------
-> chronic_liver_disease = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_l~te |     10,073    14473.15     875.676     -21900      21077


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
neurologic~e |        919   14mar1992    7914.777  15jan1900  15jun2019

-------------------------------------------------------------------------------
-> neurological_condition = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
neurologic~e |          0

-------------------------------------------------------------------------------
-> neurological_condition = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
neurologic~e |        919    11761.66    7914.777     -21900      21715


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_k~te |          0

-------------------------------------------------------------------------------
-> chronic_kidney_disease = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
chronic_k~te |          0


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
organ_tran~e |         21   15aug1978    12670.92  15jan1900  15jan2015

-------------------------------------------------------------------------------
-> organ_transplant = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
organ_tran~e |          0

-------------------------------------------------------------------------------
-> organ_transplant = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
organ_tran~e |         21    6801.667    12670.92     -21900      20103


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dysplenia_~e |     10,046   13dec1998    755.2741  15jan1900  15apr2000

-------------------------------------------------------------------------------
-> dysplenia = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dysplenia_~e |          0

-------------------------------------------------------------------------------
-> dysplenia = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dysplenia_~e |     10,046    14226.33    755.2741     -21900      14715


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
sickle_cel~e |          1   15apr2008           .  15apr2008  15apr2008

-------------------------------------------------------------------------------
-> sickle_cell = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
sickle_cel~e |          0

-------------------------------------------------------------------------------
-> sickle_cell = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
sickle_cel~e |          1       17637           .      17637      17637


    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ra_sle_pso~e |        876   17nov1989    9893.396  15jan1900  15feb2017

-------------------------------------------------------------------------------
-> ra_sle_psoriasis = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ra_sle_pso~e |          0

-------------------------------------------------------------------------------
-> ra_sle_psoriasis = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ra_sle_pso~e |        876    10913.29    9893.396     -21900      20865


. 
. 
. 
. * Outcome dates
. *****??? 
. 
. 
. 
. 
. ****************************************
. *  Cross-check expected relationships  *
. ****************************************
. 
. * everything vs each demographic/lifestyle
. * (i.e. vs age, sex, smoke, bmi cat, imd)
. 
. /*  Relationships between demographic/lifestyle variables  */
. 
. * agegroup, male, smoke, bmicat, imd, ethnicity
. 
. 
. /*  Relationships with demographic/lifestyle variables  */
. 
. * Relationships with age
. foreach var of varlist  chronic_respiratory_disease     ///
>                                                 asthma                       
>                            ///
>                                                 chronic_cardiac_disease      
>            ///
>                                                 diabetes                     
>                            ///
>                                                 lung_cancer                  
>                    ///
>                                                 haem_cancer                  
>                            ///
>                                                 other_cancer                 
>                    ///
>                                                 bone_marrow_transplant       
>            ///
>                                                 chemo_radio_therapy          
>            ///
>                                                 chronic_liver_disease        
>            ///
>                                                 neurological_condition       
>            ///
>                                                 chronic_kidney_disease       
>            ///
>                                                 organ_transplant             
>                    ///     
>                                                 spleen                       
>                            ///
>                                                 immunosuppressed             
>                    ///
>                                                 ra_sle_psoriasis             
>                    {
  2.         tab agegroup `var', r
  3. }

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |  Respiratory disease
   Grouped |    (excl. asthma)
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,419        246 |    35,665 
           |     99.31       0.69 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,267        153 |    27,420 
           |     99.44       0.56 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,610        167 |    29,777 
           |     99.44       0.56 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,353        111 |    14,464 
           |     99.23       0.77 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,676         87 |    11,763 
           |     99.26       0.74 |    100.00 
-----------+----------------------+----------
       80+ |    22,266        155 |    22,421 
           |     99.31       0.69 |    100.00 
-----------+----------------------+----------
     Total |   140,591        919 |   141,510 
           |     99.35       0.65 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |        Asthma
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,628         37 |    35,665 
           |     99.90       0.10 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,387         33 |    27,420 
           |     99.88       0.12 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,764         13 |    29,777 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,453         11 |    14,464 
           |     99.92       0.08 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,759          4 |    11,763 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
       80+ |    22,413          8 |    22,421 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
     Total |   141,404        106 |   141,510 
           |     99.93       0.07 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |     Heart disease
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    24,836     10,829 |    35,665 
           |     69.64      30.36 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,045        375 |    27,420 
           |     98.63       1.37 |    100.00 
-----------+----------------------+----------
    50-<60 |    19,323     10,454 |    29,777 
           |     64.89      35.11 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,098        366 |    14,464 
           |     97.47       2.53 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,469        294 |    11,763 
           |     97.50       2.50 |    100.00 
-----------+----------------------+----------
       80+ |    21,860        561 |    22,421 
           |     97.50       2.50 |    100.00 
-----------+----------------------+----------
     Total |   118,631     22,879 |   141,510 
           |     83.83      16.17 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |       Diabetes
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    22,736     12,929 |    35,665 
           |     63.75      36.25 |    100.00 
-----------+----------------------+----------
    40-<50 |    19,935      7,485 |    27,420 
           |     72.70      27.30 |    100.00 
-----------+----------------------+----------
    50-<60 |    14,336     15,441 |    29,777 
           |     48.14      51.86 |    100.00 
-----------+----------------------+----------
    60-<70 |    10,891      3,573 |    14,464 
           |     75.30      24.70 |    100.00 
-----------+----------------------+----------
    70-<80 |     9,591      2,172 |    11,763 
           |     81.54      18.46 |    100.00 
-----------+----------------------+----------
       80+ |    21,992        429 |    22,421 
           |     98.09       1.91 |    100.00 
-----------+----------------------+----------
     Total |    99,481     42,029 |   141,510 
           |     70.30      29.70 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |      Lung cancer
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,656          9 |    35,665 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,415          5 |    27,420 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,769          8 |    29,777 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,459          5 |    14,464 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,761          2 |    11,763 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
       80+ |    22,416          5 |    22,421 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
     Total |   141,476         34 |   141,510 
           |     99.98       0.02 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |     Haem. cancer
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    25,625     10,040 |    35,665 
           |     71.85      28.15 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,400         20 |    27,420 
           |     99.93       0.07 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,753         24 |    29,777 
           |     99.92       0.08 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,439         25 |    14,464 
           |     99.83       0.17 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,736         27 |    11,763 
           |     99.77       0.23 |    100.00 
-----------+----------------------+----------
       80+ |    22,403         18 |    22,421 
           |     99.92       0.08 |    100.00 
-----------+----------------------+----------
     Total |   131,356     10,154 |   141,510 
           |     92.82       7.18 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |      Any cancer
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,452        213 |    35,665 
           |     99.40       0.60 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,331         89 |    27,420 
           |     99.68       0.32 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,648        129 |    29,777 
           |     99.57       0.43 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,370         94 |    14,464 
           |     99.35       0.65 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,672         91 |    11,763 
           |     99.23       0.77 |    100.00 
-----------+----------------------+----------
       80+ |    22,280        141 |    22,421 
           |     99.37       0.63 |    100.00 
-----------+----------------------+----------
     Total |   140,753        757 |   141,510 
           |     99.47       0.53 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |   Organ transplant
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,665          0 |    35,665 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,420          0 |    27,420 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,776          1 |    29,777 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,464          0 |    14,464 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,763          0 |    11,763 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
       80+ |    22,421          0 |    22,421 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
     Total |   141,509          1 |   141,510 
           |    100.00       0.00 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |    Chemotherapy or
   Grouped |     radiotherapy
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,635         30 |    35,665 
           |     99.92       0.08 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,413          7 |    27,420 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,764         13 |    29,777 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,458          6 |    14,464 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,752         11 |    11,763 
           |     99.91       0.09 |    100.00 
-----------+----------------------+----------
       80+ |    22,404         17 |    22,421 
           |     99.92       0.08 |    100.00 
-----------+----------------------+----------
     Total |   141,426         84 |   141,510 
           |     99.94       0.06 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped |         Liver
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    25,646     10,019 |    35,665 
           |     71.91      28.09 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,412          8 |    27,420 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,766         11 |    29,777 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,456          8 |    14,464 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,756          7 |    11,763 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
       80+ |    22,401         20 |    22,421 
           |     99.91       0.09 |    100.00 
-----------+----------------------+----------
     Total |   131,437     10,073 |   141,510 
           |     92.88       7.12 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

   Grouped | Neurological disease
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,419        246 |    35,665 
           |     99.31       0.69 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,267        153 |    27,420 
           |     99.44       0.56 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,610        167 |    29,777 
           |     99.44       0.56 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,353        111 |    14,464 
           |     99.23       0.77 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,676         87 |    11,763 
           |     99.26       0.74 |    100.00 
-----------+----------------------+----------
       80+ |    22,266        155 |    22,421 
           |     99.31       0.69 |    100.00 
-----------+----------------------+----------
     Total |   140,591        919 |   141,510 
           |     99.35       0.65 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Kidney
   Grouped |  disease
       age |         0 |     Total
-----------+-----------+----------
    18-<40 |    35,665 |    35,665 
           |    100.00 |    100.00 
-----------+-----------+----------
    40-<50 |    27,420 |    27,420 
           |    100.00 |    100.00 
-----------+-----------+----------
    50-<60 |    29,777 |    29,777 
           |    100.00 |    100.00 
-----------+-----------+----------
    60-<70 |    14,464 |    14,464 
           |    100.00 |    100.00 
-----------+-----------+----------
    70-<80 |    11,763 |    11,763 
           |    100.00 |    100.00 
-----------+-----------+----------
       80+ |    22,421 |    22,421 
           |    100.00 |    100.00 
-----------+-----------+----------
     Total |   141,510 |   141,510 
           |    100.00 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Organ transplant
   Grouped |       recipient
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,660          5 |    35,665 
           |     99.99       0.01 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,419          1 |    27,420 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,770          7 |    29,777 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,462          2 |    14,464 
           |     99.99       0.01 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,762          1 |    11,763 
           |     99.99       0.01 |    100.00 
-----------+----------------------+----------
       80+ |    22,416          5 |    22,421 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
     Total |   141,489         21 |   141,510 
           |     99.99       0.01 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |    Spleen problems
           |  (dysplenia, sickle
   Grouped |         cell)
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,656          9 |    35,665 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,417          3 |    27,420 
           |     99.99       0.01 |    100.00 
-----------+----------------------+----------
    50-<60 |    19,765     10,012 |    29,777 
           |     66.38      33.62 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,455          9 |    14,464 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,757          6 |    11,763 
           |     99.95       0.05 |    100.00 
-----------+----------------------+----------
       80+ |    22,413          8 |    22,421 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
     Total |   131,463     10,047 |   141,510 
           |     92.90       7.10 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Immunosuppressed
           |     (combination
   Grouped |      algorithm)
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,411        254 |    35,665 
           |     99.29       0.71 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,263        157 |    27,420 
           |     99.43       0.57 |    100.00 
-----------+----------------------+----------
    50-<60 |    19,599     10,178 |    29,777 
           |     65.82      34.18 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,344        120 |    14,464 
           |     99.17       0.83 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,670         93 |    11,763 
           |     99.21       0.79 |    100.00 
-----------+----------------------+----------
       80+ |    22,258        163 |    22,421 
           |     99.27       0.73 |    100.00 
-----------+----------------------+----------
     Total |   130,545     10,965 |   141,510 
           |     92.25       7.75 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |  RA, SLE, Psoriasis
   Grouped | (autoimmune disease)
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |    35,462        203 |    35,665 
           |     99.43       0.57 |    100.00 
-----------+----------------------+----------
    40-<50 |    27,286        134 |    27,420 
           |     99.51       0.49 |    100.00 
-----------+----------------------+----------
    50-<60 |    29,630        147 |    29,777 
           |     99.51       0.49 |    100.00 
-----------+----------------------+----------
    60-<70 |    14,332        132 |    14,464 
           |     99.09       0.91 |    100.00 
-----------+----------------------+----------
    70-<80 |    11,640        123 |    11,763 
           |     98.95       1.05 |    100.00 
-----------+----------------------+----------
       80+ |    22,284        137 |    22,421 
           |     99.39       0.61 |    100.00 
-----------+----------------------+----------
     Total |   140,634        876 |   141,510 
           |     99.38       0.62 |    100.00 

. 
. 
. * Relationships with sex
. foreach var of varlist  chronic_respiratory_disease     ///
>                                                 asthma                       
>                            ///
>                                                 chronic_cardiac_disease      
>            ///
>                                                 diabetes                     
>                            ///
>                                                 lung_cancer                  
>                    ///
>                                                 haem_cancer                  
>                            ///
>                                                 other_cancer                 
>                    ///
>                                                 bone_marrow_transplant       
>            ///
>                                                 chemo_radio_therapy          
>            ///
>                                                 chronic_liver_disease        
>            ///
>                                                 neurological_condition       
>            ///
>                                                 chronic_kidney_disease       
>            ///
>                                                 organ_transplant             
>                    ///     
>                                                 spleen                       
>                            ///
>                                                 immunosuppressed             
>                    ///
>                                                 ra_sle_psoriasis             
>                    {
  2.         tab male `var', r
  3. }

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |  Respiratory disease
           |    (excl. asthma)
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,270        427 |    77,697 
           |     99.45       0.55 |    100.00 
-----------+----------------------+----------
         1 |    63,321        492 |    63,813 
           |     99.23       0.77 |    100.00 
-----------+----------------------+----------
     Total |   140,591        919 |   141,510 
           |     99.35       0.65 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |        Asthma
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,666         31 |    77,697 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
         1 |    63,738         75 |    63,813 
           |     99.88       0.12 |    100.00 
-----------+----------------------+----------
     Total |   141,404        106 |   141,510 
           |     99.93       0.07 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |     Heart disease
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    66,443     11,254 |    77,697 
           |     85.52      14.48 |    100.00 
-----------+----------------------+----------
         1 |    52,188     11,625 |    63,813 
           |     81.78      18.22 |    100.00 
-----------+----------------------+----------
     Total |   118,631     22,879 |   141,510 
           |     83.83      16.17 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       Diabetes
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    57,116     20,581 |    77,697 
           |     73.51      26.49 |    100.00 
-----------+----------------------+----------
         1 |    42,365     21,448 |    63,813 
           |     66.39      33.61 |    100.00 
-----------+----------------------+----------
     Total |    99,481     42,029 |   141,510 
           |     70.30      29.70 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |      Lung cancer
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,680         17 |    77,697 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
         1 |    63,796         17 |    63,813 
           |     99.97       0.03 |    100.00 
-----------+----------------------+----------
     Total |   141,476         34 |   141,510 
           |     99.98       0.02 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |     Haem. cancer
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    67,639     10,058 |    77,697 
           |     87.05      12.95 |    100.00 
-----------+----------------------+----------
         1 |    63,717         96 |    63,813 
           |     99.85       0.15 |    100.00 
-----------+----------------------+----------
     Total |   131,356     10,154 |   141,510 
           |     92.82       7.18 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |      Any cancer
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,209        488 |    77,697 
           |     99.37       0.63 |    100.00 
-----------+----------------------+----------
         1 |    63,544        269 |    63,813 
           |     99.58       0.42 |    100.00 
-----------+----------------------+----------
     Total |   140,753        757 |   141,510 
           |     99.47       0.53 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Organ transplant
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,696          1 |    77,697 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
         1 |    63,813          0 |    63,813 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
     Total |   141,509          1 |   141,510 
           |    100.00       0.00 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |    Chemotherapy or
           |     radiotherapy
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,648         49 |    77,697 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
         1 |    63,778         35 |    63,813 
           |     99.95       0.05 |    100.00 
-----------+----------------------+----------
     Total |   141,426         84 |   141,510 
           |     99.94       0.06 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |         Liver
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    67,660     10,037 |    77,697 
           |     87.08      12.92 |    100.00 
-----------+----------------------+----------
         1 |    63,777         36 |    63,813 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
     Total |   131,437     10,073 |   141,510 
           |     92.88       7.12 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           | Neurological disease
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,270        427 |    77,697 
           |     99.45       0.55 |    100.00 
-----------+----------------------+----------
         1 |    63,321        492 |    63,813 
           |     99.23       0.77 |    100.00 
-----------+----------------------+----------
     Total |   140,591        919 |   141,510 
           |     99.35       0.65 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Kidney
           |  disease
      Male |         0 |     Total
-----------+-----------+----------
         0 |    77,697 |    77,697 
           |    100.00 |    100.00 
-----------+-----------+----------
         1 |    63,813 |    63,813 
           |    100.00 |    100.00 
-----------+-----------+----------
     Total |   141,510 |   141,510 
           |    100.00 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Organ transplant
           |       recipient
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,689          8 |    77,697 
           |     99.99       0.01 |    100.00 
-----------+----------------------+----------
         1 |    63,800         13 |    63,813 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
     Total |   141,489         21 |   141,510 
           |     99.99       0.01 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |    Spleen problems
           |  (dysplenia, sickle
           |         cell)
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,679         18 |    77,697 
           |     99.98       0.02 |    100.00 
-----------+----------------------+----------
         1 |    53,784     10,029 |    63,813 
           |     84.28      15.72 |    100.00 
-----------+----------------------+----------
     Total |   131,463     10,047 |   141,510 
           |     92.90       7.10 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Immunosuppressed
           |     (combination
           |      algorithm)
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,251        446 |    77,697 
           |     99.43       0.57 |    100.00 
-----------+----------------------+----------
         1 |    53,294     10,519 |    63,813 
           |     83.52      16.48 |    100.00 
-----------+----------------------+----------
     Total |   130,545     10,965 |   141,510 
           |     92.25       7.75 |    100.00 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |  RA, SLE, Psoriasis
           | (autoimmune disease)
      Male |         0          1 |     Total
-----------+----------------------+----------
         0 |    77,149        548 |    77,697 
           |     99.29       0.71 |    100.00 
-----------+----------------------+----------
         1 |    63,485        328 |    63,813 
           |     99.49       0.51 |    100.00 
-----------+----------------------+----------
     Total |   140,634        876 |   141,510 
           |     99.38       0.62 |    100.00 

. 
. 
. /*  Relationships between conditions  */
. 
. 
. * Respiratory
. tab chronic_respiratory_disease asthma 

Respirator |
 y disease |
    (excl. |        Asthma
   asthma) |         0          1 |     Total
-----------+----------------------+----------
         0 |   140,488        103 |   140,591 
         1 |       916          3 |       919 
-----------+----------------------+----------
     Total |   141,404        106 |   141,510 

. 
. * Cardiac
. tab diabetes chronic_cardiac_disease

           |     Heart disease
  Diabetes |         0          1 |     Total
-----------+----------------------+----------
         0 |    97,175      2,306 |    99,481 
         1 |    21,456     20,573 |    42,029 
-----------+----------------------+----------
     Total |   118,631     22,879 |   141,510 

. *tab chronic_cardiac_disease bpcat
. 
. 
. 
. 
. 
. 
. 
. ********************************************
. *  Cross-check logical date relationships  *
. ********************************************
. 
. * Cross check dates of hosp/itu/death??
. 
. 
. 
. 
. 
. 
. *****************************
. *  Check survival settings  *
. *****************************
. 
. * Death
. stset stime_died, fail(died) enter(enter_date) origin(enter_date) id(patient_
> id) 

                id:  patient_id
     failure event:  died != 0 & died < .
obs. time interval:  (stime_died[_n-1], stime_died]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    141,510  total observations
     36,874  multiple records at same instant                   PROBABLE ERROR
             (stime_died[_n-1]==stime_died)
      1,188  observations begin on or after (first) failure
------------------------------------------------------------------------------
    103,448  observations remaining, representing
    103,448  subjects
     12,894  failures in single-failure-per-subject data
  6,063,109  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        64

. sort _t

. gen cum_died = sum(_d)

. line cum_died _t, sort(_t)

. graph export "output/events_died.eps", replace as(eps)
(file output/events_died.eps written in EPS format)

. 
. * Hospitalised for Covid
. stset stime_hosp, fail(hosp) enter(enter_date) origin(enter_date) id(patient_
> id) 

                id:  patient_id
     failure event:  hosp != 0 & hosp < .
obs. time interval:  (stime_hosp[_n-1], stime_hosp]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    141,510  total observations
     29,218  multiple records at same instant                   PROBABLE ERROR
             (stime_hosp[_n-1]==stime_hosp)
      4,762  observations begin on or after (first) failure
------------------------------------------------------------------------------
    107,530  observations remaining, representing
    106,600  subjects
     24,775  failures in single-failure-per-subject data
  5,565,732  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        64

. sort _t

. gen cum_hosp = sum(_d)

. line cum_hosp _t, sort(_t)

. graph export "output/events_hosp.eps", replace as(eps)
(file output/events_hosp.eps written in EPS format)

. 
. 
. * ITU admission for Covid
. stset stime_itu, fail(itu) enter(enter_date) origin(enter_date) id(patient_id
> ) 

                id:  patient_id
     failure event:  itu != 0 & itu < .
obs. time interval:  (stime_itu[_n-1], stime_itu]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    141,510  total observations
     35,024  multiple records at same instant                   PROBABLE ERROR
             (stime_itu[_n-1]==stime_itu)
      1,289  observations begin on or after (first) failure
------------------------------------------------------------------------------
    105,197  observations remaining, representing
    104,451  subjects
      6,525  failures in single-failure-per-subject data
  5,955,289  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        64

. sort _t

. gen cum_itu = sum(_d)

. line cum_itu _t, sort(_t)

. graph export "output/events_itu.eps", replace as(eps)
(file output/events_itu.eps written in EPS format)

. 
. 
. 
. 
. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  /home/app/notebook/analysis/output/an_checks.log
  log type:  text
 closed on:  19 Apr 2020, 17:32:56
-------------------------------------------------------------------------------
