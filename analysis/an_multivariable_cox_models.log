----------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Github\opencorona-risk-factors-research\analysis\an_multivariable_cox_models.log
  log type:  text
 opened on:  21 Apr 2020, 13:15:54

. 
. use egdata, clear
(Poor factors dummy analysis dataset)

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bmi(string) [ethnicity(real 0)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. 
.         stcox   `age'                                                   ///
>                         i.male                                                  ///
>                         `bmi'                                                   ///
>                         i.smoke                                                 ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         i.bpcat                                                 ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthma                                                ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabetes                                              ///
>                         i.cancer_exhaem_lastyr                  ///
>                         i.haemmalig_aanaem_bmtrans_lastyr  ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                                       ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         /*endocrine?*/                                  ///
>                         /*immunosuppression?*/                  ///
>                         , strata(stp)
  5. end

. *************************************************************************************
. 
. 
. foreach outcome of any hosp died itu composite{
  2. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id) 
  3. 
. *Age spline model (not adj ethnicity)
. basecoxmodel, age("age1 age2 age3")  bmi("ib2.bmicat") ethnicity(0)
  4. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmicat_noeth, replace
  5. estat concordance /*c-statistic*/
  6.         
. *Age group model (not adj ethnicity)
. basecoxmodel, age("i.agegroup")  bmi("ib2.bmicat") ethnicity(0)
  7. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agegroup_bmicat_noeth, replace
  8. estat concordance /*c-statistic*/
  9. 
. *Complete case ethnicity model
. basecoxmodel, age("age1 age2 age3")  bmi("ib2.bmicat") ethnicity(1)
 10. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmicat_CCeth, replace
 11. estat concordance /*c-statistic*/
 12.  
. 
. ************************************************************************
. * Add IBS 
. 
. * Calculate at 60 days
. *
. *stbrier, bt(60) efron
. 
. /*
> stbrier age1 age2 age3 male i.bmicat i.smoke                                                    ///
>                 resp asthma heart diabetes cancer liver neuro_dis kidney_dis    ///
>                 transplant spleen immunosup hypertension autoimmune sle                 ///
>                 endocrine                                                                                                               ///
>                 , shared(stp) bt(60)                                                                                    ///
>                 ipcw(age1 age2 age3 male i.bmicat i.smoke                                               ///
>                 resp asthma heart diabetes cancer liver neuro_dis kidney_dis    ///
>                 transplant spleen immunosup hypertension autoimmune sle                 ///
>                 endocrine)
> */
. 
. * Simple model just to try:
. /*
> stbrier age1 age2 age3 male                                                                                     ///
>                 , shared(stp) bt(60)                                                                                    ///
>                 ipcw(age1 age2 age3 male)
> */
. ************************************************************************
. 
. } /*end of looping round outcomes*/

                id:  patient_id
     failure event:  hosp != 0 & hosp < .
obs. time interval:  (stime_hosp[_n-1], stime_hosp]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    100,570  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
    100,569  observations remaining, representing
    100,569  subjects
     20,039  failures in single-failure-per-subject data
  6,792,932  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        75

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -95620.749
Iteration 1:   log likelihood = -95605.593
Iteration 2:   log likelihood = -95605.244
Iteration 3:   log likelihood = -95605.204
Iteration 4:   log likelihood =  -95605.19
Iteration 5:   log likelihood = -95605.185
Iteration 6:   log likelihood = -95605.183
Iteration 7:   log likelihood = -95605.182
Iteration 8:   log likelihood = -95605.182
Iteration 9:   log likelihood = -95605.182
Iteration 10:  log likelihood = -95605.182
Iteration 11:  log likelihood = -95605.182
Iteration 12:  log likelihood = -95605.182
Iteration 13:  log likelihood = -95605.182
Iteration 14:  log likelihood = -95605.182
Iteration 15:  log likelihood = -95605.182
Iteration 16:  log likelihood = -95605.182
Iteration 17:  log likelihood = -95605.182
Iteration 18:  log likelihood = -95605.182
Iteration 19:  log likelihood = -95605.182
Iteration 20:  log likelihood = -95605.182
Iteration 21:  log likelihood = -95605.182
Iteration 22:  log likelihood = -95605.182
Iteration 23:  log likelihood = -95605.182
Iteration 24:  log likelihood = -95605.182
Iteration 25:  log likelihood = -95605.182
Iteration 26:  log likelihood = -95605.182
Iteration 27:  log likelihood = -95605.182
Refining estimates:
Iteration 0:   log likelihood = -95605.182
Iteration 1:   log likelihood = -95605.182

Stratified Cox regr. -- Breslow method for ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =       13,096
Time at risk    =  4458878.961
                                                LR chi2(31)      =       31.13
Log likelihood  =   -95605.182                  Prob > chi2      =      0.4595

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   .9987445   .0024781    -0.51   0.613     .9938994    1.003613
                             age2 |   1.007045   .0072977     0.97   0.333     .9928426     1.02145
                             age3 |   .9687361   .0239299    -1.29   0.198     .9229517    1.016792
                           1.male |   1.005944   .0205017     0.29   0.771     .9665533     1.04694
                                  |
                           bmicat |
             Underweight (<18.5)  |   1.000036   .0363516     0.00   0.999     .9312674    1.073884
            Overweight (25-29.9)  |   1.035189   .0297115     1.20   0.228     .9785634    1.095092
               Obese I (30-34.9)  |   1.016772   .0294383     0.57   0.566     .9606808    1.076139
              Obese II (35-39.9)  |   1.037551   .0305937     1.25   0.211     .9792886     1.09928
                 Obese III (40+)  |   1.012903   .0277502     0.47   0.640     .9599486     1.06878
                                  |
                            smoke |
                          Former  |   .9976075   .0196207    -0.12   0.903     .9598833    1.036814
                         Current  |   .9821526   .0247412    -0.71   0.475     .9348385    1.031861
                                  |
                              imd |
                               2  |   .9911704   .0352052    -0.25   0.803     .9245165     1.06263
                               3  |   1.017635   .0383242     0.46   0.643     .9452267    1.095591
                               4  |   .9950224   .0381072    -0.13   0.896     .9230679    1.072586
                               5  |   1.003706   .0352533     0.11   0.916     .9369356    1.075235
                                  |
                            bpcat |
                        Elevated  |   .9433519   .0318565    -1.73   0.084     .8829357    1.007902
                   High, stage I  |   .9460364    .020782    -2.53   0.012     .9061689    .9876579
                  High, stage II  |   .9536893    .021052    -2.15   0.032     .9133079    .9958562
                                  |
    1.chronic_respiratory_disease |   1.090143   .1124324     0.84   0.403      .890624    1.334359
                         1.asthma |   1.808471   .6415781     1.67   0.095     .9022709    3.624817
        1.chronic_cardiac_disease |   1.014021    .059034     0.24   0.811     .9046734    1.136585
                       1.diabetes |   1.008887   .0339709     0.26   0.793     .9444542    1.077715
           1.cancer_exhaem_lastyr |   .5359563    1952711    -0.00   1.000            0           .
1.haemmalig_aanaem_bmtrans_lastyr |   6.61e-13   1.68e-06    -0.00   1.000            0           .
          1.chronic_liver_disease |   .9784314   .0781399    -0.27   0.785     .8366646     1.14422
                1.stroke_dementia |   .9659368   .0394372    -0.85   0.396      .891653    1.046409
                    1.other_neuro |    1.00345   .0409064     0.08   0.933     .9263946    1.086915
         1.chronic_kidney_disease |    .987428   .0397862    -0.31   0.754      .912448    1.068569
               1.organ_transplant |    .913831   .5279691    -0.16   0.876     .2944972    2.835637
                         1.spleen |   .8973935   .0669922    -1.45   0.147     .7752451    1.038788
               1.ra_sle_psoriasis |   .9048951   .1036528    -0.87   0.383     .7229294    1.132663
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_hosp_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.5130
                            Somers' D =   0.0260

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -95620.749
Iteration 1:   log likelihood = -95604.787
Iteration 2:   log likelihood = -95604.438
Iteration 3:   log likelihood = -95604.398
Iteration 4:   log likelihood = -95604.384
Iteration 5:   log likelihood = -95604.379
Iteration 6:   log likelihood = -95604.377
Iteration 7:   log likelihood = -95604.376
Iteration 8:   log likelihood = -95604.376
Iteration 9:   log likelihood = -95604.376
Iteration 10:  log likelihood = -95604.376
Iteration 11:  log likelihood = -95604.376
Iteration 12:  log likelihood = -95604.376
Iteration 13:  log likelihood = -95604.376
Iteration 14:  log likelihood = -95604.376
Iteration 15:  log likelihood = -95604.376
Iteration 16:  log likelihood = -95604.376
Iteration 17:  log likelihood = -95604.376
Iteration 18:  log likelihood = -95604.376
Iteration 19:  log likelihood = -95604.376
Iteration 20:  log likelihood = -95604.376
Iteration 21:  log likelihood = -95604.376
Iteration 22:  log likelihood = -95604.376
Iteration 23:  log likelihood = -95604.376
Iteration 24:  log likelihood = -95604.376
Iteration 25:  log likelihood = -95604.376
Refining estimates:
Iteration 0:   log likelihood = -95604.376
Iteration 1:   log likelihood = -95604.376
Iteration 2:   log likelihood = -95604.376

Stratified Cox regr. -- Breslow method for ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =       13,096
Time at risk    =  4458878.961
                                                LR chi2(33)      =       32.75
Log likelihood  =   -95604.376                  Prob > chi2      =      0.4797

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                         agegroup |
                          40-<50  |   1.037761   .0340718     1.13   0.259     .9730844    1.106736
                          50-<60  |   1.042201   .0339161     1.27   0.204     .9778024    1.110841
                          60-<70  |    1.04262   .0365232     1.19   0.233      .973438    1.116719
                          70-<80  |   1.027212   .0377489     0.73   0.465     .9558267    1.103928
                             80+  |    .969756   .0302325    -0.99   0.325     .9122754    1.030858
                                  |
                           1.male |   1.003997   .0204865     0.20   0.845     .9646366    1.044964
                                  |
                           bmicat |
             Underweight (<18.5)  |   .9999348   .0363482    -0.00   0.999     .9311722    1.073775
            Overweight (25-29.9)  |   1.035031   .0297066     1.20   0.230     .9784145    1.094924
               Obese I (30-34.9)  |   1.016455   .0294295     0.56   0.573     .9603804    1.075804
              Obese II (35-39.9)  |   1.037212   .0305843     1.24   0.215     .9789675    1.098923
                 Obese III (40+)  |   1.012676   .0277437     0.46   0.646      .959734    1.068539
                                  |
                            smoke |
                          Former  |   .9976962   .0196231    -0.12   0.907     .9599674    1.036908
                         Current  |   .9819726   .0247375    -0.72   0.470     .9346655    1.031674
                                  |
                              imd |
                               2  |   .9912561   .0352093    -0.25   0.805     .9245945    1.062724
                               3  |   1.017174   .0383055     0.45   0.651     .9448002    1.095091
                               4  |   1.002329   .0389886     0.06   0.952      .928753    1.081734
                               5  |   1.003379   .0352413     0.10   0.923     .9366307    1.074883
                                  |
                            bpcat |
                        Elevated  |    .943174   .0318524    -1.73   0.083     .8827658    1.007716
                   High, stage I  |   .9458907   .0207791    -2.53   0.011     .9060288    .9875064
                  High, stage II  |   .9535532   .0210489    -2.15   0.031     .9131779    .9957137
                                  |
    1.chronic_respiratory_disease |   1.089072   .1123161     0.83   0.408     .8897584    1.333034
                         1.asthma |   1.824248   .6471794     1.69   0.090     .9101383    3.656457
        1.chronic_cardiac_disease |   1.016161    .059117     0.28   0.783     .9066554    1.138892
                       1.diabetes |   1.000909   .0336854     0.03   0.978     .9370176    1.069158
           1.cancer_exhaem_lastyr |   .5489543    1213131    -0.00   1.000            0           .
1.haemmalig_aanaem_bmtrans_lastyr |   1.75e-12   2.71e-06    -0.00   1.000            0           .
          1.chronic_liver_disease |   .9991521   .0762661    -0.01   0.991     .8603174    1.160391
                1.stroke_dementia |   .9660644   .0394424    -0.85   0.398     .8917709    1.046547
                    1.other_neuro |    1.00335   .0409029     0.08   0.935     .9263004    1.086808
         1.chronic_kidney_disease |   .9872348   .0397786    -0.32   0.750     .9122692    1.068361
               1.organ_transplant |   .9152013   .5287681    -0.15   0.878     .2949342    2.839933
                         1.spleen |   .8947944   .0691116    -1.44   0.150     .7690927    1.041041
               1.ra_sle_psoriasis |    .905801   .1037595    -0.86   0.388     .7236486    1.133804
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_hosp_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster saved

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.5130
                            Somers' D =   0.0261

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood =  -52268.56
Iteration 1:   log likelihood = -52251.024
Iteration 2:   log likelihood =   -52250.9
Iteration 3:   log likelihood = -52250.865
Iteration 4:   log likelihood = -52250.852
Iteration 5:   log likelihood = -52250.848
Iteration 6:   log likelihood = -52250.846
Iteration 7:   log likelihood = -52250.845
Iteration 8:   log likelihood = -52250.845
Iteration 9:   log likelihood = -52250.845
Iteration 10:  log likelihood = -52250.845
Iteration 11:  log likelihood = -52250.845
Iteration 12:  log likelihood = -52250.845
Iteration 13:  log likelihood = -52250.845
Iteration 14:  log likelihood = -52250.845
Iteration 15:  log likelihood = -52250.845
Iteration 16:  log likelihood = -52250.845
Iteration 17:  log likelihood = -52250.845
Iteration 18:  log likelihood = -52250.845
Iteration 19:  log likelihood = -52250.845
Iteration 20:  log likelihood = -52250.845
Iteration 21:  log likelihood = -52250.845
Iteration 22:  log likelihood = -52250.845
Iteration 23:  log likelihood = -52250.845
Iteration 24:  log likelihood = -52250.845
Iteration 25:  log likelihood = -52250.845
Iteration 26:  log likelihood = -52250.845
Iteration 27:  log likelihood = -52250.845
Refining estimates:
Iteration 0:   log likelihood = -52250.845
Iteration 1:   log likelihood = -52250.845
Iteration 2:   log likelihood = -52250.845

Stratified Cox regr. -- Breslow method for ties

No. of subjects =       39,029                  Number of obs    =      39,029
No. of failures =        7,712
Time at risk    =  2642057.842
                                                LR chi2(35)      =       35.43
Log likelihood  =   -52250.845                  Prob > chi2      =      0.4479

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   1.000222   .0032325     0.07   0.945     .9939067    1.006578
                             age2 |   1.001071   .0094602     0.11   0.910        .9827    1.019785
                             age3 |   .9901234   .0318904    -0.31   0.758     .9295514    1.054642
                           1.male |   1.026082   .0273008     0.97   0.333     .9739447     1.08101
                                  |
                           bmicat |
             Underweight (<18.5)  |   1.010016   .0474755     0.21   0.832     .9211237    1.107488
            Overweight (25-29.9)  |    1.06218    .039271     1.63   0.103     .9879332    1.142007
               Obese I (30-34.9)  |   1.009216    .038037     0.24   0.808     .9373521     1.08659
              Obese II (35-39.9)  |   1.016295    .039158     0.42   0.675      .942373    1.096015
                 Obese III (40+)  |   .9766066   .0350745    -0.66   0.510     .9102256    1.047829
                                  |
                            smoke |
                          Former  |   .9855675    .025261    -0.57   0.571     .9372799    1.036343
                         Current  |   .9897984   .0324905    -0.31   0.755     .9281235    1.055572
                                  |
                        ethnicity |
                           Black  |   .9598362   .0273442    -1.44   0.150     .9077114    1.014954
                           Asian  |   .9543896   .0389448    -1.14   0.253     .8810318    1.033855
                           Mixed  |   .9476519   .0403697    -1.26   0.207     .8717419    1.030172
                           Other  |   1.047726    .045137     1.08   0.279     .9628914    1.140036
                                  |
                              imd |
                               2  |   .9993041   .0462663    -0.02   0.988     .9126165    1.094226
                               3  |    .993693   .0490428    -0.13   0.898     .9020736    1.094618
                               4  |   1.021315   .0509234     0.42   0.672     .9262284    1.126162
                               5  |   .9938607   .0456509    -0.13   0.893     .9082959    1.087486
                                  |
                            bpcat |
                        Elevated  |   .8932817   .0402911    -2.50   0.012     .8177025    .9758466
                   High, stage I  |   .9798295   .0278346    -0.72   0.473     .9267656    1.035932
                  High, stage II  |   .9611592   .0277454    -1.37   0.170     .9082889    1.017107
                                  |
    1.chronic_respiratory_disease |   1.081666   .1440231     0.59   0.555     .8332136    1.404204
                         1.asthma |   1.449994    .727233     0.74   0.459     .5425666     3.87507
        1.chronic_cardiac_disease |   1.094561   .0799499     1.24   0.216     .9485616    1.263031
                       1.diabetes |   1.034106   .0450692     0.77   0.442       .94944    1.126323
           1.cancer_exhaem_lastyr |   .5630592    3501351    -0.00   1.000            0           .
1.haemmalig_aanaem_bmtrans_lastyr |   2.55e-13   1.08e-06    -0.00   1.000            0           .
          1.chronic_liver_disease |   .8952008   .0910541    -1.09   0.276     .7334013    1.092696
                1.stroke_dementia |   .9437957   .0512716    -1.06   0.287     .8484702    1.049831
                    1.other_neuro |   1.061187   .0550558     1.14   0.252      .958585    1.174772
         1.chronic_kidney_disease |   1.054045    .054856     1.01   0.312     .9518313    1.167236
               1.organ_transplant |   1.072902   .7595517     0.10   0.921     .2678917    4.296955
                         1.spleen |   .8009586   .0759346    -2.34   0.019     .6651388    .9645126
               1.ra_sle_psoriasis |   .8869429    .135962    -0.78   0.434     .6567688    1.197785
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_hosp_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster saved

         failure _d:  hosp
   analysis time _t:  (stime_hosp-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.5178
                            Somers' D =   0.0355

                id:  patient_id
     failure event:  died != 0 & died < .
obs. time interval:  (stime_died[_n-1], stime_died]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    100,570  total observations
          0  exclusions
------------------------------------------------------------------------------
    100,570  observations remaining, representing
    100,570  subjects
          4  failures in single-failure-per-subject data
  7,542,705  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        75

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -7.4169796
Iteration 1:   log likelihood = -.00961823
Iteration 2:   log likelihood = -.00351522
Iteration 3:   log likelihood = -.00129011
Iteration 4:   log likelihood = -.00047419
Iteration 5:   log likelihood = -.00017439
Iteration 6:   log likelihood = -.00006415
Iteration 7:   log likelihood =  -.0000236
Iteration 8:   log likelihood = -8.681e-06
Iteration 9:   log likelihood = -3.194e-06
Iteration 10:  log likelihood = -1.175e-06
Iteration 11:  log likelihood = -4.322e-07
Iteration 12:  log likelihood = -1.590e-07
Iteration 13:  log likelihood = -5.849e-08
Iteration 14:  log likelihood = -2.152e-08
Iteration 15:  log likelihood = -7.916e-09
Iteration 16:  log likelihood = -2.912e-09
Iteration 17:  log likelihood = -1.071e-09
Iteration 18:  log likelihood = -3.941e-10
Iteration 19:  log likelihood = -1.450e-10
Iteration 20:  log likelihood = -5.334e-11
Iteration 21:  log likelihood = -5.313e-11  (backed up)
Iteration 22:  log likelihood = -1.955e-11
Iteration 23:  log likelihood = -7.191e-12
Iteration 24:  log likelihood = -2.643e-12
Iteration 25:  log likelihood = -2.515e-12
Iteration 26:  log likelihood = -9.237e-13
Iteration 27:  log likelihood = -3.411e-13
Iteration 28:  log likelihood = -2.558e-13
Iteration 29:  log likelihood = -9.237e-14
Iteration 30:  log likelihood = -9.237e-14  (backed up)
Refining estimates:
Iteration 0:   log likelihood = -9.237e-14
Iteration 1:   log likelihood = -3.553e-14
Iteration 2:   log likelihood = -3.553e-14

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            1
Time at risk    =      4946989
                                                LR chi2(23)      =       14.83
Log likelihood  =   -3.553e-14                  Prob > chi2      =      0.9005

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   .5569553    1997881    -0.00   1.000            0           .
                             age2 |   .5219684   2.07e+07    -0.00   1.000            0           .
                             age3 |   119.9441   2.15e+10     0.00   1.000            0           .
                           1.male |   6.09e-06   1009.186    -0.00   1.000            0           .
                                  |
                           bmicat |
             Underweight (<18.5)  |   .0000194   3579.453    -0.00   1.000            0           .
            Overweight (25-29.9)  |    .005544    3179042    -0.00   1.000            0           .
               Obese I (30-34.9)  |   .0005361   180403.7    -0.00   1.000            0           .
              Obese II (35-39.9)  |    6794.34   8.04e+11     0.00   1.000            0           .
                 Obese III (40+)  |   1.28e-09   .1574397    -0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   8.371983   2.68e+08     0.00   1.000            0           .
                         Current  |   .0069169   742352.3    -0.00   1.000            0           .
                                  |
                              imd |
                               2  |   .0356474    2673178    -0.00   1.000            0           .
                               3  |   7.38e-11          .        .       .            .           .
                               4  |   1.67e-06   452.5103    -0.00   1.000            0           .
                               5  |   .0000301   6317.263    -0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |   1.19e-10   .0208308    -0.00   1.000            0           .
                   High, stage I  |   .0001176   13945.47    -0.00   1.000            0           .
                  High, stage II  |   .0512945   3.80e+07    -0.00   1.000            0           .
                                  |
    1.chronic_respiratory_disease |   9.77e+08          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   2.10e-09   3.518606    -0.00   1.000            0           .
                       1.diabetes |   16.15489   5.63e+09     0.00   1.000            0           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   .0000797   142440.1    -0.00   1.000            0           .
                1.stroke_dementia |   1.18e-08   22.82705    -0.00   1.000            0           .
                    1.other_neuro |   2.76e-13   .0000543    -0.00   1.000            0           .
         1.chronic_kidney_disease |   6.20e+19          .        .       .            .           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   42857.73   2.59e+13     0.00   1.000            0           .
               1.ra_sle_psoriasis |     9590.4          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_died_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   1.0000
                            Somers' D =   1.0000

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -7.4169796
Iteration 1:   log likelihood = -.00509838
Iteration 2:   log likelihood = -.00186909
Iteration 3:   log likelihood = -.00068673
Iteration 4:   log likelihood = -.00025252
Iteration 5:   log likelihood = -.00009288
Iteration 6:   log likelihood = -.00003417
Iteration 7:   log likelihood = -.00001257
Iteration 8:   log likelihood = -4.624e-06
Iteration 9:   log likelihood = -1.701e-06
Iteration 10:  log likelihood = -6.258e-07
Iteration 11:  log likelihood = -2.302e-07
Iteration 12:  log likelihood = -8.469e-08
Iteration 13:  log likelihood = -3.116e-08
Iteration 14:  log likelihood = -1.146e-08
Iteration 15:  log likelihood = -4.216e-09
Iteration 16:  log likelihood = -1.551e-09
Iteration 17:  log likelihood = -5.706e-10
Iteration 18:  log likelihood = -2.099e-10
Iteration 19:  log likelihood = -7.722e-11
Iteration 20:  log likelihood = -2.841e-11
Iteration 21:  log likelihood = -1.044e-11
Iteration 22:  log likelihood = -3.851e-12
Iteration 23:  log likelihood = -1.421e-12
Iteration 24:  log likelihood = -5.258e-13
Iteration 25:  log likelihood = -1.990e-13
Iteration 26:  log likelihood = -7.105e-14
Iteration 27:  log likelihood = -2.842e-14
Iteration 28:  log likelihood = -1.421e-14
Iteration 29:  log likelihood =          0
Refining estimates:
Iteration 0:   log likelihood =          0
Iteration 1:   log likelihood =          0

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            1
Time at risk    =      4946989
                                                LR chi2(23)      =       14.83
Log likelihood  =            0                  Prob > chi2      =      0.9005

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                         agegroup |
                          40-<50  |   7.84e-13   .0005213    -0.00   1.000            0           .
                          50-<60  |   9.86e-12   .0246349    -0.00   1.000            0           .
                          60-<70  |   1.11e-09   .3903308    -0.00   1.000            0           .
                          70-<80  |   8.90e-06   22238.21    -0.00   1.000            0           .
                             80+  |   4.15e-11   .1189982    -0.00   1.000            0           .
                                  |
                           1.male |   2.22e-08   5.589177    -0.00   1.000            0           .
                                  |
                           bmicat |
             Underweight (<18.5)  |   3.040786   1.63e+09     0.00   1.000            0           .
            Overweight (25-29.9)  |   14.07228          .        .       .            .           .
               Obese I (30-34.9)  |   2.762583   6.90e+09     0.00   1.000            0           .
              Obese II (35-39.9)  |   339019.8   3.30e+13     0.00   1.000            0           .
                 Obese III (40+)  |   1.714438   7.28e+08     0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   6.054125   4.16e+08     0.00   1.000            0           .
                         Current  |   .0357508          .        .       .            .           .
                                  |
                              imd |
                               2  |   1.23e+09   2.18e+17     0.00   1.000            0           .
                               3  |    11.8882          .        .       .            .           .
                               4  |   50056.35   1.25e+14     0.00   1.000            0           .
                               5  |   1404.372   2.62e+12     0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |   7.74e-08   19.25557    -0.00   1.000            0           .
                   High, stage I  |   .0015292   297064.7    -0.00   1.000            0           .
                  High, stage II  |   3.11e-07   609.9639    -0.00   1.000            0           .
                                  |
    1.chronic_respiratory_disease |   14372.72          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   583.6649   1.38e+12     0.00   1.000            0           .
                       1.diabetes |   .8641063   2.23e+09    -0.00   1.000            0           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   1.93e-12          .        .       .            .           .
                1.stroke_dementia |   1692.937   2.67e+12     0.00   1.000            0           .
                    1.other_neuro |   3.16e-10   .5863383    -0.00   1.000            0           .
         1.chronic_kidney_disease |   4.14e+16   3.51e+24     0.00   1.000            0           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   2.13e+11   5.26e+20     0.00   1.000            0           .
               1.ra_sle_psoriasis |   12237.09          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_died_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster saved

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   1.0000
                            Somers' D =   1.0000

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -6.9275579
Iteration 1:   log likelihood =  -.0001809
Iteration 2:   log likelihood = -.00006654
Iteration 3:   log likelihood = -.00002448
Iteration 4:   log likelihood = -9.005e-06
Iteration 5:   log likelihood = -3.313e-06
Iteration 6:   log likelihood = -1.219e-06
Iteration 7:   log likelihood = -4.483e-07
Iteration 8:   log likelihood = -1.649e-07
Iteration 9:   log likelihood = -6.067e-08
Iteration 10:  log likelihood = -2.232e-08
Iteration 11:  log likelihood = -8.211e-09
Iteration 12:  log likelihood = -3.021e-09
Iteration 13:  log likelihood = -1.111e-09
Iteration 14:  log likelihood = -4.088e-10
Iteration 15:  log likelihood = -1.504e-10
Iteration 16:  log likelihood = -5.533e-11
Iteration 17:  log likelihood = -2.036e-11
Iteration 18:  log likelihood = -7.489e-12
Iteration 19:  log likelihood = -2.757e-12
Iteration 20:  log likelihood = -1.016e-12
Iteration 21:  log likelihood = -3.766e-13
Iteration 22:  log likelihood = -1.421e-13
Iteration 23:  log likelihood = -1.421e-13
Refining estimates:
Iteration 0:   log likelihood = -1.421e-13
Iteration 1:   log likelihood = -8.527e-14
Iteration 2:   log likelihood = -7.105e-14
Iteration 3:   log likelihood = -5.684e-14
Iteration 4:   log likelihood = -2.132e-14
Iteration 5:   log likelihood = -7.105e-15
Iteration 6:   log likelihood = -7.105e-15

Stratified Cox regr. -- no ties

No. of subjects =       39,029                  Number of obs    =      39,029
No. of failures =            1
Time at risk    =      2927164
                                                LR chi2(25)      =       13.86
Log likelihood  =   -7.105e-15                  Prob > chi2      =      0.9642

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   .2062845   843432.7    -0.00   1.000            0           .
                             age2 |   8.918178   3.44e+08     0.00   1.000            0           .
                             age3 |   .0706897   1.37e+07    -0.00   1.000            0           .
                           1.male |   5.64e-06    1449.38    -0.00   1.000            0           .
                                  |
                           bmicat |
             Underweight (<18.5)  |   .0000449   29973.45    -0.00   1.000            0           .
            Overweight (25-29.9)  |   250.0686   4.61e+10     0.00   1.000            0           .
               Obese I (30-34.9)  |   6.949014          .        .       .            .           .
              Obese II (35-39.9)  |   2.50e+07   3.61e+15     0.00   1.000            0           .
                 Obese III (40+)  |   5093.217   1.02e+12     0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   236904.6   4.17e+13     0.00   1.000            0           .
                         Current  |   6129.634   1.12e+12     0.00   1.000            0           .
                                  |
                        ethnicity |
                           Black  |   .0020557   155809.1    -0.00   1.000            0           .
                           Asian  |   .0203766    9311402    -0.00   1.000            0           .
                           Mixed  |   .0001884   28699.84    -0.00   1.000            0           .
                           Other  |   6.23e-07   175.9184    -0.00   1.000            0           .
                                  |
                              imd |
                               2  |   17951.71   3.08e+12     0.00   1.000            0           .
                               3  |   .0001745          .        .       .            .           .
                               4  |   1.58e-07   28.40638    -0.00   1.000            0           .
                               5  |   .1077712   3.42e+07    -0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |    .000059   14079.15    -0.00   1.000            0           .
                   High, stage I  |   1.615024   3.35e+08     0.00   1.000            0           .
                  High, stage II  |   .0007376     334958    -0.00   1.000            0           .
                                  |
    1.chronic_respiratory_disease |   65.37437          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   1.77e-07   60.42277    -0.00   1.000            0           .
                       1.diabetes |   74475.51   1.92e+13     0.00   1.000            0           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   1.678406          .        .       .            .           .
                1.stroke_dementia |   1.99e-10          .        .       .            .           .
                    1.other_neuro |   2.32e+09   8.71e+17     0.00   1.000            0           .
         1.chronic_kidney_disease |   5.83e+17   9.58e+25     0.00   1.000            0           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   5.38e+10   5.92e+19     0.00   1.000            0           .
               1.ra_sle_psoriasis |   435640.6          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_died_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster saved

         failure _d:  died
   analysis time _t:  (stime_died-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   1.0000
                            Somers' D =   1.0000

                id:  patient_id
     failure event:  itu != 0 & itu < .
obs. time interval:  (stime_itu[_n-1], stime_itu]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    100,570  total observations
          0  exclusions
------------------------------------------------------------------------------
    100,570  observations remaining, representing
    100,570  subjects
          5  failures in single-failure-per-subject data
  7,542,481  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        75

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -14.821867
Iteration 1:   log likelihood = -9.0119533
Iteration 2:   log likelihood = -5.2685935
Iteration 3:   log likelihood =  -3.797632
Iteration 4:   log likelihood = -2.9925442
Iteration 5:   log likelihood = -2.2818164
Iteration 6:   log likelihood = -1.7733716
Iteration 7:   log likelihood = -1.5279175
Iteration 8:   log likelihood = -1.4370147
Iteration 9:   log likelihood = -1.4046829
Iteration 10:  log likelihood = -1.3930175
Iteration 11:  log likelihood = -1.3887617
Iteration 12:  log likelihood = -1.3872013
Iteration 13:  log likelihood = -1.3866279
Iteration 14:  log likelihood = -1.3864171
Iteration 15:  log likelihood = -1.3863395
Iteration 16:  log likelihood =  -1.386311
Iteration 17:  log likelihood = -1.3863005
Iteration 18:  log likelihood = -1.3862966
Iteration 19:  log likelihood = -1.3862952
Iteration 20:  log likelihood = -1.3862947
Iteration 21:  log likelihood = -1.3862945
Iteration 22:  log likelihood = -1.3862944
Iteration 23:  log likelihood = -1.3862944
Iteration 24:  log likelihood = -1.3862944
Iteration 25:  log likelihood = -1.3862944
Iteration 26:  log likelihood = -1.3862944
Iteration 27:  log likelihood = -1.3862944
Iteration 28:  log likelihood = -1.3862944
Iteration 29:  log likelihood = -1.3862944
Iteration 30:  log likelihood = -1.3862944
Iteration 31:  log likelihood = -1.3862944
Iteration 32:  log likelihood = -1.3862944
Iteration 33:  log likelihood = -1.3862944
Iteration 34:  log likelihood = -1.3862944
Iteration 35:  log likelihood = -1.3862944
Iteration 36:  log likelihood = -1.3862944
Iteration 37:  log likelihood = -1.3862944
Iteration 38:  log likelihood = -1.3862944
Iteration 39:  log likelihood = -1.3862944
Iteration 40:  log likelihood = -1.3862944
Iteration 41:  log likelihood = -1.3862944
Iteration 42:  log likelihood = -1.3862944
Iteration 43:  log likelihood = -1.3862944
Iteration 44:  log likelihood = -1.3862944
Refining estimates:
Iteration 0:   log likelihood = -1.3862944
Iteration 1:   log likelihood = -1.3862944

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            2
Time at risk    =      4946900
                                                LR chi2(14)      =       26.87
Log likelihood  =   -1.3862944                  Prob > chi2      =      0.0200

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   3.22e-07   1.844286    -0.00   1.000            0           .
                             age2 |   3.43e+17   1.71e+24     0.00   1.000            0           .
                             age3 |   1.04e-50          .        .       .            .           .
                           1.male |   1.01e-10          .        .       .            .           .
                                  |
                           bmicat |
             Underweight (<18.5)  |   .0010489    3053392    -0.00   1.000            0           .
            Overweight (25-29.9)  |   2.04e-25          .        .       .            .           .
               Obese I (30-34.9)  |   1.54e-23          .        .       .            .           .
              Obese II (35-39.9)  |   .3661269   3.50e+07    -0.00   1.000            0           .
                 Obese III (40+)  |   2.22e+15   1.45e+23     0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   4.91e-79   7.30e-70    -0.00   1.000            0           .
                         Current  |   3.16e-27          .        .       .            .           .
                                  |
                              imd |
                               2  |   2.08e-75          .        .       .            .           .
                               3  |   2.57e-21   1.32e-12    -0.00   1.000            0           .
                               4  |   4.61e+28          .        .       .            .           .
                               5  |   3.55e-98          .        .       .            .           .
                                  |
                            bpcat |
                        Elevated  |   3.19e-47          .        .       .            .           .
                   High, stage I  |   7.30e-79   5.35e-71    -0.00   1.000            0           .
                  High, stage II  |   1.02e-15   4.29e-08    -0.00   1.000            0           .
                                  |
    1.chronic_respiratory_disease |   1.21e-88          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   8.95e+38   5.14e+46     0.00   1.000            0           .
                       1.diabetes |   2.84e+89   1.73e+97     0.00   1.000            0           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   2.9e-161   7.9e-152    -0.00   1.000            0           .
                1.stroke_dementia |   8.73e-16   5.50e-08    -0.00   1.000            0           .
                    1.other_neuro |   1.49e-81   4.34e-72    -0.00   1.000            0           .
         1.chronic_kidney_disease |    .009822          .        .       .            .           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   8.20e-39          .        .       .            .           .
               1.ra_sle_psoriasis |   2.36e+63          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_itu_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.9995
                            Somers' D =   0.9991

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -14.821867
Iteration 1:   log likelihood = -8.9734854
Iteration 2:   log likelihood = -6.2258656
Iteration 3:   log likelihood = -3.7557338
Iteration 4:   log likelihood = -2.6832062
Iteration 5:   log likelihood = -2.0045222
Iteration 6:   log likelihood = -1.6267471
Iteration 7:   log likelihood =  -1.473482
Iteration 8:   log likelihood = -1.4178982
Iteration 9:   log likelihood = -1.3978587
Iteration 10:  log likelihood = -1.3905412
Iteration 11:  log likelihood = -1.3878558
Iteration 12:  log likelihood = -1.3868687
Iteration 13:  log likelihood = -1.3865057
Iteration 14:  log likelihood = -1.3863721
Iteration 15:  log likelihood =  -1.386323
Iteration 16:  log likelihood = -1.3863049
Iteration 17:  log likelihood = -1.3862982
Iteration 18:  log likelihood = -1.3862958
Iteration 19:  log likelihood = -1.3862949
Iteration 20:  log likelihood = -1.3862946
Iteration 21:  log likelihood = -1.3862944
Iteration 22:  log likelihood = -1.3862944
Iteration 23:  log likelihood = -1.3862944
Iteration 24:  log likelihood = -1.3862944
Iteration 25:  log likelihood = -1.3862944
Iteration 26:  log likelihood = -1.3862944
Iteration 27:  log likelihood = -1.3862944
Iteration 28:  log likelihood = -1.3862944
Iteration 29:  log likelihood = -1.3862944
Iteration 30:  log likelihood = -1.3862944
Iteration 31:  log likelihood = -1.3862944
Iteration 32:  log likelihood = -1.3862944
Iteration 33:  log likelihood = -1.3862944
Iteration 34:  log likelihood = -1.3862944
Iteration 35:  log likelihood = -1.3862944
Iteration 36:  log likelihood = -1.3862944
Iteration 37:  log likelihood = -1.3862944
Iteration 38:  log likelihood = -1.3862944
Iteration 39:  log likelihood = -1.3862944
Iteration 40:  log likelihood = -1.3862944
Iteration 41:  log likelihood = -1.3862944
Iteration 42:  log likelihood = -1.3862944
Iteration 43:  log likelihood = -1.3862944
Refining estimates:
Iteration 0:   log likelihood = -1.3862944
Iteration 1:   log likelihood = -1.3862944
Iteration 2:   log likelihood = -1.3862944
Iteration 3:   log likelihood = -1.3862944
Iteration 4:   log likelihood = -1.3862944
Iteration 5:   log likelihood = -1.3862944

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            2
Time at risk    =      4946900
                                                LR chi2(16)      =       26.87
Log likelihood  =   -1.3862944                  Prob > chi2      =      0.0429

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                         agegroup |
                          40-<50  |   3.46e-58   1.41e-49    -0.00   1.000            0           .
                          50-<60  |   1.78e-66          .        .       .            .           .
                          60-<70  |   6.81e-56   2.63e-47    -0.00   1.000            0           .
                          70-<80  |   6.81e-53   1.97e-44    -0.00   1.000            0           .
                             80+  |   2.49e+39   8.16e+47     0.00   1.000            0           .
                                  |
                           1.male |   7.18e-15   1.70e-07    -0.00   1.000            0           .
                                  |
                           bmicat |
             Underweight (<18.5)  |    .000248          .        .       .            .           .
            Overweight (25-29.9)  |   1.23e-48          .        .       .            .           .
               Obese I (30-34.9)  |   1.95e-30   8.52e-22    -0.00   1.000            0           .
              Obese II (35-39.9)  |   4.07e-21   1.07e-12    -0.00   1.000            0           .
                 Obese III (40+)  |   5.96e+16   9.59e+24     0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   2.93e-74   2.72e-65    -0.00   1.000            0           .
                         Current  |   4.52e-15   1.46e-07    -0.00   1.000            0           .
                                  |
                              imd |
                               2  |   2.02e-73          .        .       .            .           .
                               3  |   .0043241          .        .       .            .           .
                               4  |   2.73e+34   7.89e+42     0.00   1.000            0           .
                               5  |   7.5e-101          .        .       .            .           .
                                  |
                            bpcat |
                        Elevated  |   3.29e-06   426.6535    -0.00   1.000            0           .
                   High, stage I  |   8.94e-25          .        .       .            .           .
                  High, stage II  |   6.58e-20          .        .       .            .           .
                                  |
    1.chronic_respiratory_disease |   2.40e-93          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   7.01e+24   2.71e+33     0.00   1.000            0           .
                       1.diabetes |   6.6e+109   7.7e+117     0.00   1.000            0           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   5.1e-114   4.3e-105    -0.00   1.000            0           .
                1.stroke_dementia |   2.25e-15   1.43e-07    -0.00   1.000            0           .
                    1.other_neuro |   2.60e-94          .        .       .            .           .
         1.chronic_kidney_disease |   3.61e-07          .        .       .            .           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   3.40e-15          .        .       .            .           .
               1.ra_sle_psoriasis |   1.29e+84          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_itu_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster saved

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.9995
                            Somers' D =   0.9991

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -13.823241
Iteration 1:   log likelihood = -13.679087
Iteration 2:   log likelihood = -7.6569246  (backed up)
Iteration 3:   log likelihood = -6.5262812
Iteration 4:   log likelihood = -3.0132247
Iteration 5:   log likelihood = -.82464702
Iteration 6:   log likelihood = -.73789758
Iteration 7:   log likelihood = -.70923428
Iteration 8:   log likelihood = -.69902616
Iteration 9:   log likelihood = -.69530712
Iteration 10:  log likelihood = -.69394204
Iteration 11:  log likelihood =  -.6934398
Iteration 12:  log likelihood =  -.6932549
Iteration 13:  log likelihood = -.69318683
Iteration 14:  log likelihood = -.69316177
Iteration 15:  log likelihood = -.69315255
Iteration 16:  log likelihood = -.69314916
Iteration 17:  log likelihood = -.69314791
Iteration 18:  log likelihood = -.69314745
Iteration 19:  log likelihood = -.69314728
Iteration 20:  log likelihood = -.69314722
Iteration 21:  log likelihood = -.69314719
Iteration 22:  log likelihood = -.69314719
Iteration 23:  log likelihood = -.69314718
Iteration 24:  log likelihood = -.69314718
Iteration 25:  log likelihood = -.69314718
Iteration 26:  log likelihood = -.69314718
Iteration 27:  log likelihood = -.69314718
Iteration 28:  log likelihood = -.69314718
Iteration 29:  log likelihood = -.69314718
Iteration 30:  log likelihood = -.69314718
Iteration 31:  log likelihood = -.69314718
Iteration 32:  log likelihood = -.69314718
Iteration 33:  log likelihood = -.69314718
Iteration 34:  log likelihood = -.69314718
Iteration 35:  log likelihood = -.69314718
Iteration 36:  log likelihood = -.69314718
Iteration 37:  log likelihood = -.69314718
Iteration 38:  log likelihood = -.69314718
Iteration 39:  log likelihood = -.69314718
Iteration 40:  log likelihood = -.69314718
Refining estimates:
Iteration 0:   log likelihood = -.69314718
Iteration 1:   log likelihood = -.69314718

Stratified Cox regr. -- no ties

No. of subjects =       39,029                  Number of obs    =      39,029
No. of failures =            2
Time at risk    =      2927075
                                                LR chi2(17)      =       26.26
Log likelihood  =   -.69314718                  Prob > chi2      =      0.0698

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   .0607729          .        .       .            .           .
                             age2 |   16.89559   1.89e+07     0.00   1.000            0           .
                             age3 |   .7175213          .        .       .            .           .
                           1.male |   1.92e+11   2.79e+19     0.00   1.000            0           .
                                  |
                           bmicat |
             Underweight (<18.5)  |    1110463   2.19e+15     0.00   1.000            0           .
            Overweight (25-29.9)  |   6.17e-31          .        .       .            .           .
               Obese I (30-34.9)  |   7.15e-11   .2060699    -0.00   1.000            0           .
              Obese II (35-39.9)  |   .0250977   3.18e+07    -0.00   1.000            0           .
                 Obese III (40+)  |   1.96e+16   4.14e+24     0.00   1.000            0           .
                                  |
                            smoke |
                          Former  |   7.45e-18   2.96e-09    -0.00   1.000            0           .
                         Current  |   .0008343          .        .       .            .           .
                                  |
                        ethnicity |
                           Black  |   1.37e-27   2.21e-19    -0.00   1.000            0           .
                           Asian  |   1.13e-07   272.3477    -0.00   1.000            0           .
                           Mixed  |   1.26e-09   .9891908    -0.00   1.000            0           .
                           Other  |   .0033775          .        .       .            .           .
                                  |
                              imd |
                               2  |   8.80e-14          .        .       .            .           .
                               3  |   71.58008   1.55e+11     0.00   1.000            0           .
                               4  |   6.07e+36          .        .       .            .           .
                               5  |   352.1261   5.67e+10     0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |   1.30e-21   2.97e-12    -0.00   1.000            0           .
                   High, stage I  |   4.17e-40   1.54e-31    -0.00   1.000            0           .
                  High, stage II  |   2.56e-09          .        .       .            .           .
                                  |
    1.chronic_respiratory_disease |   1.11e-32          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   4.24e+12          .        .       .            .           .
                       1.diabetes |   1.43e+28          .        .       .            .           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   7.33e-76   1.00e-66    -0.00   1.000            0           .
                1.stroke_dementia |   3.88e-16   3.23e-08    -0.00   1.000            0           .
                    1.other_neuro |   7.26e-14          .        .       .            .           .
         1.chronic_kidney_disease |   8.43e-08   13.92209    -0.00   1.000            0           .
               1.organ_transplant |          1  (omitted)
                         1.spleen |   2.90e-20          .        .       .            .           .
               1.ra_sle_psoriasis |   1.18e+27          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_itu_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster saved

         failure _d:  itu
   analysis time _t:  (stime_itu-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.9998
                            Somers' D =   0.9995

                id:  patient_id
     failure event:  composite != 0 & composite < .
obs. time interval:  (stime_composite[_n-1], stime_composite]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
    100,570  total observations
          0  exclusions
------------------------------------------------------------------------------
    100,570  observations remaining, representing
    100,570  subjects
          9  failures in single-failure-per-subject data
  7,542,481  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        75

         failure _d:  composite
   analysis time _t:  (stime_composite-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -22.238246
Iteration 1:   log likelihood = -19.800218
Iteration 2:   log likelihood = -12.013036
Iteration 3:   log likelihood = -10.185937
Iteration 4:   log likelihood = -8.3251483
Iteration 5:   log likelihood = -7.9341876
Iteration 6:   log likelihood = -7.8827895
Iteration 7:   log likelihood = -7.8751951
Iteration 8:   log likelihood = -7.8724423
Iteration 9:   log likelihood = -7.8714309
Iteration 10:  log likelihood =  -7.871059
Iteration 11:  log likelihood = -7.8709222
Iteration 12:  log likelihood = -7.8708719
Iteration 13:  log likelihood = -7.8708533
Iteration 14:  log likelihood = -7.8708465
Iteration 15:  log likelihood =  -7.870844
Iteration 16:  log likelihood = -7.8708431
Iteration 17:  log likelihood = -7.8708428
Iteration 18:  log likelihood = -7.8708426
Iteration 19:  log likelihood = -7.8708426
Iteration 20:  log likelihood = -7.8708426
Iteration 21:  log likelihood = -7.8708426
Iteration 22:  log likelihood = -7.8708426
Iteration 23:  log likelihood = -7.8708426
Iteration 24:  log likelihood = -7.8708426
Iteration 25:  log likelihood = -7.8708426
Iteration 26:  log likelihood = -7.8708426
Iteration 27:  log likelihood = -7.8708426
Iteration 28:  log likelihood = -7.8708426
Iteration 29:  log likelihood = -7.8708426
Iteration 30:  log likelihood = -7.8708426
Iteration 31:  log likelihood = -7.8708426
Iteration 32:  log likelihood = -7.8708426
Iteration 33:  log likelihood = -7.8708426
Iteration 34:  log likelihood = -7.8708426
Iteration 35:  log likelihood = -7.8708426
Iteration 36:  log likelihood = -7.8708426
Iteration 37:  log likelihood = -7.8708426
Refining estimates:
Iteration 0:   log likelihood = -7.8708426
Iteration 1:   log likelihood = -7.8708426

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            3
Time at risk    =      4946900
                                                LR chi2(25)      =       28.73
Log likelihood  =   -7.8708426                  Prob > chi2      =      0.2752

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                             age1 |   .9498497   .1779977    -0.27   0.784     .6578751    1.371407
                             age2 |   .7703681   .4577134    -0.44   0.661     .2404129    2.468532
                             age3 |   4.246918   9.186803     0.67   0.504     .0612041    294.6911
                           1.male |   .2346965   .7372156    -0.46   0.644     .0004975    110.7271
                                  |
                           bmicat |
             Underweight (<18.5)  |   7.53e-18   6.40e-09    -0.00   1.000            0           .
            Overweight (25-29.9)  |   1.98e-18   3.57e-09    -0.00   1.000            0           .
               Obese I (30-34.9)  |   1.21e-17   5.66e-09    -0.00   1.000            0           .
              Obese II (35-39.9)  |   7.396502   20.35881     0.73   0.467     .0335816    1629.116
                 Obese III (40+)  |   2.272662   6.078052     0.31   0.759     .0120244    429.5412
                                  |
                            smoke |
                          Former  |   .5508815   .9895513    -0.33   0.740     .0162945    18.62413
                         Current  |   1.404269   3.293213     0.14   0.885     .0141664    139.2003
                                  |
                              imd |
                               2  |   1.01e+10          .        .       .            .           .
                               3  |   6.91e-08   30.66675    -0.00   1.000            0           .
                               4  |   4.08e+10   7.32e+10    13.63   0.000     1.22e+09    1.37e+12
                               5  |   1.23e-06   119.3552    -0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |   3.49e-18   2.39e-09    -0.00   1.000            0           .
                   High, stage I  |   7.18e-18   1.61e-09    -0.00   1.000            0           .
                  High, stage II  |   .1674002   .3930237    -0.76   0.446       .00168    16.68069
                                  |
    1.chronic_respiratory_disease |   4.40e-17          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   14.13912   31.10089     1.20   0.228     .1897102     1053.79
                       1.diabetes |   9.611121   30.49416     0.71   0.476     .0191462    4824.654
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   2.27e-21   1.44e-12    -0.00   1.000            0           .
                1.stroke_dementia |   1.320358   2.930844     0.13   0.900     .0170314    102.3606
                    1.other_neuro |   9.12e-19   1.92e-09    -0.00   1.000            0           .
         1.chronic_kidney_disease |   22.33907   33.32451     2.08   0.037     1.200265    415.7698
               1.organ_transplant |          1  (omitted)
                         1.spleen |   1.82e-09   3.985114    -0.00   1.000            0           .
               1.ra_sle_psoriasis |   9.29e-17   1.36e-07    -0.00   1.000            0           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_composite_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

         failure _d:  composite
   analysis time _t:  (stime_composite-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.9916
                            Somers' D =   0.9833

         failure _d:  composite
   analysis time _t:  (stime_composite-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -22.238246
Iteration 1:   log likelihood = -19.397827
Iteration 2:   log likelihood = -11.556822
Iteration 3:   log likelihood =  -9.680774
Iteration 4:   log likelihood = -8.0913756
Iteration 5:   log likelihood = -7.2345107
Iteration 6:   log likelihood = -7.0389865
Iteration 7:   log likelihood = -6.9998367
Iteration 8:   log likelihood = -6.9835507
Iteration 9:   log likelihood =  -6.976776
Iteration 10:  log likelihood = -6.9740815
Iteration 11:  log likelihood = -6.9730511
Iteration 12:  log likelihood = -6.9726657
Iteration 13:  log likelihood = -6.9725231
Iteration 14:  log likelihood = -6.9724704
Iteration 15:  log likelihood = -6.9724511
Iteration 16:  log likelihood = -6.9724439
Iteration 17:  log likelihood = -6.9724413
Iteration 18:  log likelihood = -6.9724404
Iteration 19:  log likelihood =   -6.97244
Iteration 20:  log likelihood = -6.9724399
Iteration 21:  log likelihood = -6.9724398
Iteration 22:  log likelihood = -6.9724398
Iteration 23:  log likelihood = -6.9724398
Iteration 24:  log likelihood = -6.9724398
Iteration 25:  log likelihood = -6.9724398
Iteration 26:  log likelihood = -6.9724398
Iteration 27:  log likelihood = -6.9724398
Iteration 28:  log likelihood = -6.9724398
Iteration 29:  log likelihood = -6.9724398
Iteration 30:  log likelihood = -6.9724398
Iteration 31:  log likelihood = -6.9724398
Iteration 32:  log likelihood = -6.9724398
Iteration 33:  log likelihood = -6.9724398
Iteration 34:  log likelihood = -6.9724398
Iteration 35:  log likelihood = -6.9724398
Iteration 36:  log likelihood = -6.9724398
Iteration 37:  log likelihood = -6.9724398
Refining estimates:
Iteration 0:   log likelihood = -6.9724398
Iteration 1:   log likelihood = -6.9724398
Iteration 2:   log likelihood = -6.9724398
Iteration 3:   log likelihood = -6.9724398
Iteration 4:   log likelihood = -6.9724398
Iteration 5:   log likelihood = -6.9724398

Stratified Cox regr. -- no ties

No. of subjects =       65,960                  Number of obs    =      65,960
No. of failures =            3
Time at risk    =      4946900
                                                LR chi2(18)      =       30.53
Log likelihood  =   -6.9724398                  Prob > chi2      =      0.0326

---------------------------------------------------------------------------------------------------
                               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------+----------------------------------------------------------------
                         agegroup |
                          40-<50  |   1.14e-26   5.96e-18    -0.00   1.000            0           .
                          50-<60  |   1.34e-27   1.27e-18    -0.00   1.000            0           .
                          60-<70  |   8.17e-30          .        .       .            .           .
                          70-<80  |   1.99e-30          .        .       .            .           .
                             80+  |   .5579112   1.143718    -0.28   0.776     .0100369    31.01195
                                  |
                           1.male |   1.73e-10   5.29e-10    -7.36   0.000     4.34e-13    6.91e-08
                                  |
                           bmicat |
             Underweight (<18.5)  |   6.57e-28   1.82e-18    -0.00   1.000            0           .
            Overweight (25-29.9)  |   8.42e-19          .        .       .            .           .
               Obese I (30-34.9)  |   1.86e-18   4.04e-09    -0.00   1.000            0           .
              Obese II (35-39.9)  |   14.01427   44.19305     0.84   0.402     .0289977     6772.94
                 Obese III (40+)  |   5.308008   15.59082     0.57   0.570     .0167788    1679.204
                                  |
                            smoke |
                          Former  |   .8471874     1.5476    -0.09   0.928     .0236073     30.4027
                         Current  |   2.351646   6.087455     0.33   0.741     .0147217    375.6528
                                  |
                              imd |
                               2  |   1.23e+10   2.38e+10    11.96   0.000     2.72e+08    5.52e+11
                               3  |   2.77e-18   3.75e-09    -0.00   1.000            0           .
                               4  |   1.67e+10          .        .       .            .           .
                               5  |   1.59e-16   1.01e-07    -0.00   1.000            0           .
                                  |
                            bpcat |
                        Elevated  |   2.09e-19          .        .       .            .           .
                   High, stage I  |   6.76e-28   7.06e-19    -0.00   1.000            0           .
                  High, stage II  |   .2626621   .6333203    -0.55   0.579     .0023282    29.63331
                                  |
    1.chronic_respiratory_disease |   2.48e-17          .        .       .            .           .
                         1.asthma |          1  (omitted)
        1.chronic_cardiac_disease |   19.28252   48.93544     1.17   0.244     .1333437    2788.399
                       1.diabetes |   4.60e+10          .        .       .            .           .
           1.cancer_exhaem_lastyr |          1  (omitted)
1.haemmalig_aanaem_bmtrans_lastyr |          1  (omitted)
          1.chronic_liver_disease |   2.87e-32          .        .       .            .           .
                1.stroke_dementia |   1.015189   2.508015     0.01   0.995     .0080106    128.6565
                    1.other_neuro |   8.92e-20          .        .       .            .           .
         1.chronic_kidney_disease |    18.9377   30.27341     1.84   0.066     .8253037    434.5507
               1.organ_transplant |          1  (omitted)
                         1.spleen |   1.91e+14          .        .       .            .           .
               1.ra_sle_psoriasis |   1.60e-08          .        .       .            .           .
---------------------------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/models/an_multivariate_cox_models_composite_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster saved

         failure _d:  composite
   analysis time _t:  (stime_composite-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

  Harrell's C concordance statistic

                          Harrell's C =   0.9941
                            Somers' D =   0.9881

         failure _d:  composite
   analysis time _t:  (stime_composite-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -20.749818
Iteration 1:   log likelihood = -14.334525
Iteration 2:   log likelihood = -9.0469224
Iteration 3:   log likelihood = -5.9317436
Iteration 4:   log likelihood =  -4.474195
Iteration 5:   log likelihood = -3.6986609
Iteration 6:   log likelihood = -2.7900324
Iteration 7:   log likelihood = -1.6412787
Iteration 8:   log likelihood = -1.0220206
Iteration 9:   log likelihood =   -.814798
Iteration 10:  log likelihood = -.73819046
Iteration 11:  log likelihood = -.70974566
Iteration 12:  log likelihood = -.69926486
Iteration 13:  log likelihood =   -.695401
Iteration 14:  log likelihood = -.69397637
Iteration 15:  log likelihood = -.69345222
Iteration 16:  log likelihood = -.69325942
Iteration 17:  log likelihood = -.69318847
Iteration 18:  log likelihood = -.69316241
Iteration 19:  log likelihood = -.69315628
Iteration 20:  log likelihood = -.69315069
Iteration 21:  log likelihood = -.69314884
flat region resulting in a missing likelihood
r(430);

end of do-file

r(430);

. tab died_ons_covid_flag_any

died_ons_co |
vid_flag_an |
          y |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    100,569      100.00      100.00
          1 |          1        0.00      100.00
------------+-----------------------------------
      Total |    100,570      100.00

. do "C:\Users\Krish\AppData\Local\Temp\STD359c_000000.tmp"

. confirm string variable died_date_ons

. gen died_date_ons = date(died_date_ons, "YMD")
variable died_date_ons already defined
r(110);

end of do-file

r(110);

. clear

. import delimited input.csv
(40 vars, 104,662 obs)

. do "C:\Users\Krish\AppData\Local\Temp\STD359c_000000.tmp"

. ********************************************************************************
. *
. *       Do-file:                cr_create_analysis_dataset.do
. *
. *       Project:                Risk factors for poor outcomes in Covid-19
. *
. *       Programmed by:  Elizabeth Williamson
. *
. *       Data used:              Data in memory (from input.csv)
. *
. *       Data created:   egdata.dta
. *
. *       Other output:   None
. *
. ********************************************************************************
. *
. *       Purpose:                This do-file creates the variables required for the 
. *                                       main analysis and saves into a Stata dataset.
. *  
. ********************************************************************************
. 
. *******************************************************************************
. *!!!!!!NOTE ON CODE GENERATING FAKE DATA WHICH NEEDS TO BE REPLACED LATER!!!!!!
. *
. *1)     chronic_kidney_disease
. *               stroke_dementia
. *               other_neuro
. *
. *       Remove "gen" commands under "generate some extra variables, additional risk factors" (around line 67)
. *
. *       Remove the section TEMPORARY - generate fake data for chronic_kidney_disease, stroke_dementia, other_neuro
. *               Under "Create binary comorbidity indices from dates" (around line 248)
. *
. *
. *2)     Fake hospitalisation outcome is generated under *FAKE OUTCOME DATA ~ line 110
. *
. *******************************************************************************
. 
. ***********************************
. *  Generate some extra variables  *
. ***********************************
. 
. *** This section won't be needed once real data is fully available
. 
. 
. set seed 123489

. 
. 
. * Smoking status (assuming input is called smoking_status)
. gen     smoking_status = "N" if uniform()<0.3
(73,335 missing values generated)

. replace smoking_status = "E" if uniform()<0.6 & smoking_status==""
(43,816 real changes made)

. replace smoking_status = "S" if uniform()<0.6 & smoking_status==""
(17,662 real changes made)

. 
. * Ethnicity 
. gen     ethnicity = "W" if uniform()<0.3
(73,269 missing values generated)

. replace ethnicity = "B" if uniform()<0.2 & ethnicity==""
(14,774 real changes made)

. replace ethnicity = "A" if uniform()<0.1 & ethnicity==""
(5,915 real changes made)

. replace ethnicity = "M" if uniform()<0.1 & ethnicity==""
(5,361 real changes made)

. replace ethnicity = "O" if uniform()<0.1 & ethnicity==""
(4,773 real changes made)

. replace ethnicity = "U" if ethnicity==""
(42,446 real changes made)

. 
. 
. * Additional risk factors
. gen chronic_kidney_disease = .
(104,662 missing values generated)

. gen stroke_dementia = .
(104,662 missing values generated)

. gen other_neuro = .
(104,662 missing values generated)

. 
. * ASTHMA - assume this comes as a binary rather than date **********************
. 
. * BMI
. replace bmi = rnormal(30, 15)
(104,662 real changes made)

. replace bmi = . if bmi<= 15
(16,626 real changes made, 16,626 to missing)

. 
. 
. * SBP and DBP  **********
. replace bp_sys   = rnormal(110, 15)
(104,662 real changes made)

. replace bp_dias  = rnormal(80, 15)
(104,662 real changes made)

. 
. * Gen STP
. gen stp_temp = runiform()

. egen stp = cut(stp_temp), group(40)

. drop stp_temp

. 
. 
. ****** THIS NEXT LITTLE SECTION WILL BE NEEDED FOR THE REAL DATA ******
. * Dates   
. gen enter_date = date("01/02/2020", "DMY")

. format enter_date %td

. 
. gen end_study_date = date("16/04/2020", "DMY")

. format end_study_date %td

. 
. * Outcomes (real)
. * DEATH - defined as earliest of cpns, or ons<with covid cause>
. confirm string variable died_date_ons

. gen died_date_ons = date(died_date_ons, "YMD")
variable died_date_ons already defined
r(110);

end of do-file

r(110);

. clear

. import delimited input.csv
(40 vars, 104,662 obs)

. do "C:\Users\Krish\AppData\Local\Temp\STD359c_000000.tmp"

. ********************************************************************************
. *
. *       Do-file:                cr_create_analysis_dataset.do
. *
. *       Project:                Risk factors for poor outcomes in Covid-19
. *
. *       Programmed by:  Elizabeth Williamson
. *
. *       Data used:              Data in memory (from input.csv)
. *
. *       Data created:   egdata.dta
. *
. *       Other output:   None
. *
. ********************************************************************************
. *
. *       Purpose:                This do-file creates the variables required for the 
. *                                       main analysis and saves into a Stata dataset.
. *  
. ********************************************************************************
. 
. *******************************************************************************
. *!!!!!!NOTE ON CODE GENERATING FAKE DATA WHICH NEEDS TO BE REPLACED LATER!!!!!!
. *
. *1)     chronic_kidney_disease
. *               stroke_dementia
. *               other_neuro
. *
. *       Remove "gen" commands under "generate some extra variables, additional risk factors" (around line 67)
. *
. *       Remove the section TEMPORARY - generate fake data for chronic_kidney_disease, stroke_dementia, other_neuro
. *               Under "Create binary comorbidity indices from dates" (around line 248)
. *
. *
. *2)     Fake hospitalisation outcome is generated under *FAKE OUTCOME DATA ~ line 110
. *
. *******************************************************************************
. 
. ***********************************
. *  Generate some extra variables  *
. ***********************************
. 
. *** This section won't be needed once real data is fully available
. 
. 
. set seed 123489

. 
. 
. * Smoking status (assuming input is called smoking_status)
. gen     smoking_status = "N" if uniform()<0.3
(73,335 missing values generated)

. replace smoking_status = "E" if uniform()<0.6 & smoking_status==""
(43,816 real changes made)

. replace smoking_status = "S" if uniform()<0.6 & smoking_status==""
(17,662 real changes made)

. 
. * Ethnicity 
. gen     ethnicity = "W" if uniform()<0.3
(73,269 missing values generated)

. replace ethnicity = "B" if uniform()<0.2 & ethnicity==""
(14,774 real changes made)

. replace ethnicity = "A" if uniform()<0.1 & ethnicity==""
(5,915 real changes made)

. replace ethnicity = "M" if uniform()<0.1 & ethnicity==""
(5,361 real changes made)

. replace ethnicity = "O" if uniform()<0.1 & ethnicity==""
(4,773 real changes made)

. replace ethnicity = "U" if ethnicity==""
(42,446 real changes made)

. 
. 
. * Additional risk factors
. gen chronic_kidney_disease = .
(104,662 missing values generated)

. gen stroke_dementia = .
(104,662 missing values generated)

. gen other_neuro = .
(104,662 missing values generated)

. 
. * ASTHMA - assume this comes as a binary rather than date **********************
. 
. * BMI
. replace bmi = rnormal(30, 15)
(104,662 real changes made)

. replace bmi = . if bmi<= 15
(16,626 real changes made, 16,626 to missing)

. 
. 
. * SBP and DBP  **********
. replace bp_sys   = rnormal(110, 15)
(104,662 real changes made)

. replace bp_dias  = rnormal(80, 15)
(104,662 real changes made)

. 
. * Gen STP
. gen stp_temp = runiform()

. egen stp = cut(stp_temp), group(40)

. drop stp_temp

. 
. 
. ****** THIS NEXT LITTLE SECTION WILL BE NEEDED FOR THE REAL DATA ******
. * Dates   
. gen enter_date = date("01/02/2020", "DMY")

. format enter_date %td

. 
. gen end_study_date = date("16/04/2020", "DMY")

. format end_study_date %td

. 
. * Outcomes (real)
. * DEATH - defined as earliest of cpns, or ons<with covid cause>
. foreach var of varlist died_date_ons died_date_cpns{
  2.         confirm string variable `var'
  3.         rename `var' `var'_dstr
  4.         gen `var' = date(`var'_dstr, "YMD")
  5.         drop `var'_dstr
  6.         }
(104,651 missing values generated)
(104,658 missing values generated)

. gen died_date_onscovid = died_date_ons if died_ons_covid_flag_any==1
(104,661 missing values generated)

. 
. gen death_date = min (died_date_cpns, died_date_onscovid)
min not found
r(111);

end of do-file

r(111);

. do "C:\Users\Krish\AppData\Local\Temp\STD359c_000000.tmp"

. gen death_date = min(died_date_cpns, died_date_onscovid)
(104,657 missing values generated)

. gen died = death_date<.

. 
end of do-file

. tab died

       died |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    104,657      100.00      100.00
          1 |          5        0.00      100.00
------------+-----------------------------------
      Total |    104,662      100.00

. l died* if died==1

        +-------------------------------------------------------------+
        | died_o~y   died_o~g   died~ons   died~pns   died_d~d   died |
        |-------------------------------------------------------------|
  8956. |        0          0      21988      22010          .      1 |
  9561. |        0          0      21946      22012          .      1 |
  9563. |        1          0      21988          .      21988      1 |
 10194. |        0          0      21946      22010          .      1 |
 10322. |        0          0      21946      22007          .      1 |
        +-------------------------------------------------------------+

. l death* died* if died==1

        +------------------------------------------------------------------------+
        | death_~e   died_o~y   died_o~g   died~ons   died~pns   died_d~d   died |
        |------------------------------------------------------------------------|
  8956. |    22010          0          0      21988      22010          .      1 |
  9561. |    22012          0          0      21946      22012          .      1 |
  9563. |    21988          1          0      21988          .      21988      1 |
 10194. |    22010          0          0      21946      22010          .      1 |
 10322. |    22007          0          0      21946      22007          .      1 |
        +------------------------------------------------------------------------+

. l death* died* *flag if died==1
variable *flag not found
r(111);

. l death* died* *flag* if died==1

        +----------------------------------------------------------------------------------------------+
        | death_~e   died_o~y   died_o~g   died~ons   died~pns   died_d~d   died   died_o~y   died_o~g |
        |----------------------------------------------------------------------------------------------|
  8956. |    22010          0          0      21988      22010          .      1          0          0 |
  9561. |    22012          0          0      21946      22012          .      1          0          0 |
  9563. |    21988          1          0      21988          .      21988      1          1          0 |
 10194. |    22010          0          0      21946      22010          .      1          0          0 |
 10322. |    22007          0          0      21946      22007          .      1          0          0 |
        +----------------------------------------------------------------------------------------------+

. clear

. import delimited input.csv
(40 vars, 104,662 obs)

. do "C:\Users\Krish\AppData\Local\Temp\STD359c_000000.tmp"

. replace died = 0 if death_date>end_study_date /*censored*/
died ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "C:\Github\opencorona-risk-factors-research\analysis\cr_create_analysis_dataset.do"

. ********************************************************************************
. *
. *       Do-file:                cr_create_analysis_dataset.do
. *
. *       Project:                Risk factors for poor outcomes in Covid-19
. *
. *       Programmed by:  Elizabeth Williamson
. *
. *       Data used:              Data in memory (from input.csv)
. *
. *       Data created:   egdata.dta
. *
. *       Other output:   None
. *
. ********************************************************************************
. *
. *       Purpose:                This do-file creates the variables required for the 
. *                                       main analysis and saves into a Stata dataset.
. *  
. ********************************************************************************
. 
. *******************************************************************************
. *!!!!!!NOTE ON CODE GENERATING FAKE DATA WHICH NEEDS TO BE REPLACED LATER!!!!!!
. *
. *1)     chronic_kidney_disease
. *               stroke_dementia
. *               other_neuro
. *
. *       Remove "gen" commands under "generate some extra variables, additional risk factors" (around line 67)
. *
. *       Remove the section TEMPORARY - generate fake data for chronic_kidney_disease, stroke_dementia, other_neuro
. *               Under "Create binary comorbidity indices from dates" (around line 248)
. *
. *
. *2)     Fake hospitalisation outcome is generated under *FAKE OUTCOME DATA ~ line 110
. *
. *******************************************************************************
. 
. ***********************************
. *  Generate some extra variables  *
. ***********************************
. 
. *** This section won't be needed once real data is fully available
. 
. 
. set seed 123489

. 
. 
. * Smoking status (assuming input is called smoking_status)
. gen     smoking_status = "N" if uniform()<0.3
(73,335 missing values generated)

. replace smoking_status = "E" if uniform()<0.6 & smoking_status==""
(43,816 real changes made)

. replace smoking_status = "S" if uniform()<0.6 & smoking_status==""
(17,662 real changes made)

. 
. * Ethnicity 
. gen     ethnicity = "W" if uniform()<0.3
(73,269 missing values generated)

. replace ethnicity = "B" if uniform()<0.2 & ethnicity==""
(14,774 real changes made)

. replace ethnicity = "A" if uniform()<0.1 & ethnicity==""
(5,915 real changes made)

. replace ethnicity = "M" if uniform()<0.1 & ethnicity==""
(5,361 real changes made)

. replace ethnicity = "O" if uniform()<0.1 & ethnicity==""
(4,773 real changes made)

. replace ethnicity = "U" if ethnicity==""
(42,446 real changes made)

. 
. 
. * Additional risk factors
. gen chronic_kidney_disease = .
(104,662 missing values generated)

. gen stroke_dementia = .
(104,662 missing values generated)

. gen other_neuro = .
(104,662 missing values generated)

. 
. * ASTHMA - assume this comes as a binary rather than date **********************
. 
. * BMI
. replace bmi = rnormal(30, 15)
(104,662 real changes made)

. replace bmi = . if bmi<= 15
(16,626 real changes made, 16,626 to missing)

. 
. 
. * SBP and DBP  **********
. replace bp_sys   = rnormal(110, 15)
(104,662 real changes made)

. replace bp_dias  = rnormal(80, 15)
(104,662 real changes made)

. 
. * Gen STP
. gen stp_temp = runiform()

. egen stp = cut(stp_temp), group(40)

. drop stp_temp

. 
. 
. ****** THIS NEXT LITTLE SECTION WILL BE NEEDED FOR THE REAL DATA ******
. * Dates   
. gen enter_date = date("01/02/2020", "DMY")

. format enter_date %td

. 
. gen end_study_date = date("16/04/2020", "DMY")

. format end_study_date %td

. 
. * Outcomes (real)
. * DEATH - defined as earliest of cpns, or ons<with covid cause>
. foreach var of varlist died_date_ons died_date_cpns{
  2.         confirm string variable `var'
  3.         rename `var' `var'_dstr
  4.         gen `var' = date(`var'_dstr, "YMD")
  5.         drop `var'_dstr
  6.         }
(104,651 missing values generated)
(104,658 missing values generated)

. gen died_date_onscovid = died_date_ons if died_ons_covid_flag_any==1
(104,661 missing values generated)

. 
. gen death_date = min(died_date_cpns, died_date_onscovid)
(104,657 missing values generated)

. gen died = death_date<.

. 
. * ITU
. confirm string variable icu_date_admitted

. assert icu == (icu_date_admitted!="")

. rename icu itu

. gen itu_date = date(icu_date_admitted, "YMD")
(104,657 missing values generated)

. 
. 
. ****** END OF SECTION NEEDED FOR THE REAL DATA ******
. 
. *FAKE OUTCOME DATA
. * Hospitalisation
. gen hosp = uniform()<0.20

. 
. gen lag = min(death_date, end_study_date) - enter_date

. 
. gen hosp_date = enter_date + runiform()*lag

. replace hosp_date = . if hosp==0
(83,770 real changes made, 83,770 to missing)

. format hosp_date %td

. 
. drop lag

. 
. 
. 
. 
. ****************************
. *  Create required cohort  *
. ****************************
. 
. * Age: Exclude children
. drop if age<18
(1,482 observations deleted)

. 
. * Age: Exclude those with implausible ages
. assert age<.

. drop if age>105
(1,518 observations deleted)

. 
. * Sex: Exclude categories other than M and F
. assert inlist(sex, "M", "F", "I", "U")

. drop if inlist(sex, "I", "U")
(1,092 observations deleted)

. 
. 
. 
. 
. ******************************
. *  Convert strings to dates  *
. ******************************
. 
. * To be added: dates related to outcomes
. foreach var of varlist  bp_sys_date                                     ///
>                                                 bp_dias_date                                    ///
>                                                 bmi_date_measured                               ///
>                                                 chronic_respiratory_disease     ///
>                                                 chronic_cardiac_disease                 ///
>                                                 diabetes                                                ///
>                                                 lung_cancer                                     ///
>                                                 haem_cancer                                             ///
>                                                 other_cancer                                    ///
>                                                 bone_marrow_transplant                  ///
>                                                 chemo_radio_therapy                     ///
>                                                 chronic_liver_disease                   ///
>                                                 stroke_dementia                                 ///
>                                                 other_neuro                                     ///
>                                                 chronic_kidney_disease                  ///
>                                                 organ_transplant                                ///     
>                                                 dysplenia                                               ///
>                                                 sickle_cell                                     ///
>                                                 aplastic_anaemia                                ///
>                                                 hiv                                                     ///
>                                                 genetic_immunodeficiency                ///
>                                                 immunosuppression_nos                   ///
>                                                 ra_sle_psoriasis  {
  2.         capture confirm string variable `var'
  3.         if _rc!=0 {
  4.                 assert `var'==.
  5.                 rename `var' `var'_date
  6.         }
  7.         else {
  8.                 replace `var' = `var' + "-15"
  9.                 rename `var' `var'_dstr
 10.                 replace `var'_dstr = " " if `var'_dstr == "-15"
 11.                 gen `var'_date = date(`var'_dstr, "YMD") 
 12.                 order `var'_date, after(`var'_dstr)
 13.                 drop `var'_dstr
 14.         }
 15.         format `var'_date %td
 16. }
variable bp_sys_date_measured was str7 now str10
(100,570 real changes made)
(35,292 real changes made)
(35,292 missing values generated)
variable bp_dias_date_measured was str7 now str10
(100,570 real changes made)
(45,515 real changes made)
(45,515 missing values generated)
variable bmi_date_measured was str7 now str10
(100,570 real changes made)
(90,129 real changes made)
(90,129 missing values generated)
variable chronic_respiratory_disease was str7 now str10
(100,570 real changes made)
(99,913 real changes made)
(99,913 missing values generated)
variable chronic_cardiac_disease was str7 now str10
(100,570 real changes made)
(78,299 real changes made)
(78,299 missing values generated)
variable diabetes was str7 now str10
(100,570 real changes made)
(72,692 real changes made)
(72,692 missing values generated)
variable lung_cancer was str7 now str10
(100,570 real changes made)
(100,553 real changes made)
(100,553 missing values generated)
variable haem_cancer was str7 now str10
(100,570 real changes made)
(90,472 real changes made)
(90,472 missing values generated)
variable other_cancer was str7 now str10
(100,570 real changes made)
(100,044 real changes made)
(100,044 missing values generated)
variable bone_marrow_transplant was str7 now str10
(100,570 real changes made)
(100,569 real changes made)
(100,569 missing values generated)
variable chemo_radio_therapy was str7 now str10
(100,570 real changes made)
(100,500 real changes made)
(100,500 missing values generated)
variable chronic_liver_disease was str7 now str10
(100,570 real changes made)
(90,509 real changes made)
(90,509 missing values generated)
variable organ_transplant was str7 now str10
(100,570 real changes made)
(100,551 real changes made)
(100,551 missing values generated)
variable dysplenia was str7 now str10
(100,570 real changes made)
(90,531 real changes made)
(90,531 missing values generated)
variable sickle_cell was str7 now str10
(100,570 real changes made)
(100,569 real changes made)
(100,569 missing values generated)
variable aplastic_anaemia was str7 now str10
(100,570 real changes made)
(99,913 real changes made)
(99,913 missing values generated)
variable hiv was str7 now str10
(100,570 real changes made)
(99,913 real changes made)
(99,913 missing values generated)
variable genetic_immunodeficiency was str7 now str10
(100,570 real changes made)
(99,913 real changes made)
(99,913 missing values generated)
variable immunosuppression_nos was str7 now str10
(100,570 real changes made)
(99,913 real changes made)
(99,913 missing values generated)
variable ra_sle_psoriasis was str7 now str10
(100,570 real changes made)
(99,919 real changes made)
(99,919 missing values generated)

. 
. rename bmi_date_measured_date bmi_date_measured

. rename bp_dias_date_measured_date  bp_dias_date

. rename bp_sys_date_measured_date   bp_sys_date

. 
. * NB: Some BMI dates in future or after cohort entry
. 
. 
. 
. **************************************************
. *  Create binary comorbidity indices from dates  *
. **************************************************
. 
. * Comorbidities ever before
. foreach var of varlist  chronic_respiratory_disease_date        ///
>                                                 chronic_cardiac_disease_date            ///
>                                                 diabetes                                                        ///
>                                                 lung_cancer_date                                        ///
>                                                 haem_cancer_date                                        ///
>                                                 other_cancer_date                                       ///
>                                                 bone_marrow_transplant_date             ///
>                                                 chemo_radio_therapy_date                        ///
>                                                 chronic_liver_disease_date                      ///
>                                                 stroke_dementia_date                            ///
>                                                 other_neuro_date                                        ///
>                                                 chronic_kidney_disease_date             ///
>                                                 organ_transplant_date                           ///     
>                                                 dysplenia_date                                          ///
>                                                 sickle_cell_date                                        ///
>                                                 hiv_date                                                        ///
>                                                 genetic_immunodeficiency_date           ///
>                                                 ra_sle_psoriasis_date   {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'< d(1/2/2020))
  4.         order `newvar', after(`var')
  5. }

. 
. /* Grouped comorbidities  */
. 
. * Cancer except haematological 
. gen lung_cancer_lastyr  = inrange(lung_cancer_date,  d(1/2/2019), d(1/2/2020))

. gen other_cancer_lastyr = inrange(other_cancer_date, d(1/2/2019), d(1/2/2020))

. egen cancer_exhaem_lastyr = rowmax(lung_cancer_lastyr other_cancer_lastyr)

. 
. * Haem malig, aplastic anaemia, bone marrow transplant
. gen haem_cancer_lastyr  = inrange(haem_cancer_date,  d(1/2/2019), d(1/2/2020))

. gen aplanaemia_lastyr  = inrange(aplastic_anaemia_date,  d(1/2/2019), d(1/2/2020))

. gen bone_marrow_transplant_lastyr  = inrange(bone_marrow_transplant_date,  d(1/2/2019), d(1/2/2020))

. egen haemmalig_aanaem_bmtrans_lastyr = rowmax(haem_cancer_lastyr aplanaemia_lastyr bone_marrow_transplant_lastyr)

.  
. order lung_cancer_lastyr other_cancer_lastyr haem_cancer_lastyr aplanaemia_lastyr bone_marrow_transplant_lastyr cancer_exhaem_lastyr haemmalig_aanaem_bm
> trans_lastyr, after(other_cancer)

. 
. * Spleen problems (dysplenia/splenectomy/etc and sickle cell disease)   
. egen spleen = rowmax(dysplenia sickle_cell) 

. order spleen, after(sickle_cell)

. 
. * TEMPORARY - generate fake data for chronic_kidney_disease, stroke_dementia, other_neuro
. for var chronic_kidney_disease stroke_dementia other_neuro: replace X = uniform()<0.05

->  replace chronic_kidney_disease = uniform()<0.05
(5,097 real changes made)

->  replace stroke_dementia = uniform()<0.05
(5,024 real changes made)

->  replace other_neuro = uniform()<0.05
(4,978 real changes made)

. 
. * Immunosuppressed:
. * HIV, dysplenia/sickle-cell, genetic conditions ever, OR
. * aplastic anaemia, haematological malignancies, bone marrow transplant, 
. *   chemo/radio in last year, OR
. * immunosuppression NOS in last 3 months
. gen temp1  = max(hiv, spleen, genetic_immunodeficiency)

. gen temp2  = inrange(immunosuppression_nos_date,    d(1/11/2019), d(1/2/2020))

. gen temp3  = max(inrange(aplastic_anaemia_date,          d(1/2/2019), d(1/2/2020)), ///
>                                 inrange(haem_cancer_date,                        d(1/2/2019), d(1/2/2020)), ///                 
>                                 inrange(bone_marrow_transplant_date, d(1/2/2019), d(1/2/2020)), ///
>                                 inrange(chemo_radio_therapy_date,        d(1/2/2019), d(1/2/2020))) 

. egen immunosuppressed = rowmax(temp1 temp2 temp3)

. drop temp1 temp2 temp3

. order immunosuppressed, after(immunosuppression_nos)

. 
. 
. 
. 
.                                                 
. 
. ********************************
. *  Recode and check variables  *
. ********************************
. 
. * Sex
. assert inlist(sex, "M", "F")

. gen male = sex=="M"

. drop sex

. 
. * BMI 
. * Only keep if within certain time period?
. * bmi_date_measured
. * Set implausible BMIs to missing:
. replace bmi = . if !inrange(bmi, 15, 50)
(9,205 real changes made, 9,205 to missing)

. 
. * Smoking 
. assert inlist(smoking_status, "N", "E", "S", "")

. gen     smoke = 1 if smoking_status=="N"
(70,473 missing values generated)

. replace smoke = 2 if smoking_status=="E"
(42,158 real changes made)

. replace smoke = 3 if smoking_status=="S"
(16,955 real changes made)

. replace smoke = .u if smoking_status==""
(11,360 real changes made, 11,360 to missing)

. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Unknown (.u)"

. label values smoke smoke

. drop smoking_status

. 
. 
. * Ethnicity
. rename ethnicity ethnicity_o

. assert inlist(ethnicity, "A", "B", "W", "M", "O", "U")

. gen     ethnicity = 1 if ethnicity_o=="W"
(70,391 missing values generated)

. replace ethnicity = 2 if ethnicity_o=="B"
(14,172 real changes made)

. replace ethnicity = 3 if ethnicity_o=="A"
(5,680 real changes made)

. replace ethnicity = 4 if ethnicity_o=="M"
(5,157 real changes made)

. replace ethnicity = 5 if ethnicity_o=="O"
(4,572 real changes made)

. replace ethnicity = .u if ethnicity_o=="U"
(40,810 real changes made, 40,810 to missing)

. label define ethnicity 1 "White" 2 "Black" 3 "Asian" 4 "Mixed" 5 "Other" .u "Unknown (.u)"

. label values ethnicity ethnicity

. drop ethnicity_o

. 
. 
. 
. 
. **************************
. *  Categorise variables  *
. **************************
. 
. 
. /*  Age variables  */ 
. 
. * Create categorised age
. recode age 18/39.9999=1 40/49.9999=2 50/59.9999=3 ///
>         60/69.9999=4 70/79.9999=5 80/max=6, gen(agegroup) 
(100570 differences between age and agegroup)

. 
. label define agegroup   1 "18-<40" ///
>                                                 2 "40-<50" ///
>                                                 3 "50-<60" ///
>                                                 4 "60-<70" ///
>                                                 5 "70-<80" ///
>                                                 6 "80+"

. label values agegroup agegroup

. 
. 
. * Create binary age
. recode age min/69.999=0 70/max=1, gen(age70)
(100570 differences between age and age70)

. 
. * Check there are no missing ages
. assert age<.

. assert agegroup<.

. assert age70<.

. 
. * Create restricted cubic splines fir age
. mkspline age = age, cubic nknots(4)

. 
. 
. /*  Body Mass Index  */
. 
. * BMI (NB: watch for missingness)
. gen     bmicat = .
(100,570 missing values generated)

. recode  bmicat . = 1 if bmi<18.5
(bmicat: 6327 changes made)

. recode  bmicat . = 2 if bmi<25
(bmicat: 14896 changes made)

. recode  bmicat . = 3 if bmi<30
(bmicat: 13187 changes made)

. recode  bmicat . = 4 if bmi<35
(bmicat: 12949 changes made)

. recode  bmicat . = 5 if bmi<40
(bmicat: 11838 changes made)

. recode  bmicat . = 6 if bmi<.
(bmicat: 16184 changes made)

. replace bmicat = .u if bmi>=.
(25,189 real changes made, 25,189 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"             ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Unknown (.u)"

. label values bmicat bmicat

. 
. * Create binary BMI (NB: watch for missingness; add 7=0)
. recode bmicat 6=1 .u 1/5=0, gen(obese40)
(100570 differences between bmicat and obese40)

. order obese40, after(bmicat)

. 
. 
. 
. /*  Smoking  */
. 
. * Create binary smoking
. recode smoke 3=1 1/2 .u=0, gen(currentsmoke)
(100570 differences between smoke and currentsmoke)

. order currentsmoke, after(smoke)

. 
. 
. /*  Blood pressure  */
. 
. gen     bpcat = 1 if bp_sys < 120 &  bp_dias < 80
(62,896 missing values generated)

. replace bpcat = 2 if inrange(bp_sys, 120, 130) & bp_dias<80
(8,306 real changes made)

. replace bpcat = 3 if inrange(bp_sys, 130, 140) | inrange(bp_dias, 80, 90)
(29,872 real changes made)

. replace bpcat = 4 if (bp_sys>=140 & bp_sys<.) | (bp_dias>=90 & bp_dias<.) 
(26,996 real changes made)

. replace bpcat = .u if bp_sys>=. | bp_dias>=.
(0 real changes made)

. 
. label define bpcat 1 "Normal" 2 "Elevated" 3 "High, stage I"    ///
>                                         4 "High, stage II" .u "Unknown"

. label values bpcat bpcat

. order bpcat, after(bp_dias_date)

. 
. 
. 
. 
. /*  IMD  */
. 
. * Group into 5 groups
. rename imd imd_o

. egen imd = cut(imd), group(5) icodes

. replace imd = imd + 1
(100,570 real changes made)

. 
. replace imd = .u if imd_o==-1
(1,435 real changes made, 1,435 to missing)

. drop imd_o

. label define imd 1 "1" 2 "2" 3 "3" 4 "4" 5 "5" .u "Unknown"

. label values imd imd 

. 
. 
. /*  Centred age, sex, IMD, ethnicity (for adjusted KM plots)  */ 
. 
. * Centre age (linear)
. summ age

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    100,570    55.50364    23.01542         18        105

. gen c_age = age-r(mean)

. 
. * "Centre" sex to be coded -1 +1 
. recode male 0=-1, gen(c_male)
(55242 differences between male and c_male)

. 
. * "Centre" IMD
. gen c_imd = imd - 3
(1,435 missing values generated)

. 
. * "Centre" ethnicity
. gen c_ethnicity = ethnicity - 3
(40,810 missing values generated)

. 
. 
. 
. 
. ********************************
. *  Outcomes and survival time  *
. ********************************
. 
. /*  Create survival times  */
. 
. * For looping later, name must be stime_binary_outcome_name)
. 
. gen stime_died  = min(end_study_date, death_date, died_date_ons)

. replace died = 0 if death_date>end_study_date /*censored*/
(0 real changes made)

. 
. gen stime_hosp  = min(end_study_date, death_date, hosp_date)

. replace hosp = 0 if (hosp_date>end_study_date)|(hosp_date>death_date) /*censored*/
(0 real changes made)

. 
. gen stime_itu   = min(end_study_date, death_date, itu_date)

. replace itu = 0 if min(death_date, itu_date)>end_study_date
(0 real changes made)

. 
. * Create composite outcome
. gen stime_composite = min(end_study_date, death_date, itu_date)

. gen composite = died|itu

. 
. 
. 
. *********************
. *  Label variables  *
. *********************
. 
. * Demographics
. label var patient_id            "Patient ID"

. label var age                           "Age (years)"

. label var agegroup                      "Grouped age"

. label var age70                         "70 years and older"

. label var male                          "Male"

. label var bmi                           "Body Mass Index (BMI, kg/m2)"

. label var bmicat                        "Grouped BMI"

. label var bmi_date              "Body Mass Index (BMI, kg/m2), date measured"

. label var obese40                       "Severely obese (cat 3)"

. label var smoke                         "Smoking status"

. label var currentsmoke          "Current smoker"

. label var imd                           "Index of Multiple Deprivation (IMD)"

. label var ethnicity                     "Ethnicity"

. label var stp                           "Sustainability and Transformation Partnership"

. 
. label var bp_sys                        "Systolic blood pressure"

. label var bp_sys_date           "Systolic blood pressure, date"

. label var bp_dias                       "Diastolic blood pressure"

. label var bp_dias_date          "Diastolic blood pressure, date"

. label var bpcat                         "Grouped blood pressure"

. 
. label var age1                          "Age spline 1"

. label var age2                          "Age spline 2"

. label var age3                          "Age spline 3"

. label var c_age                         "Centred age"

. label var c_male                        "Centred sex (code: -1/+1)"

. label var c_imd                         "Centred Index of Multiple Deprivation (values: -2/+2)"

. label var c_ethnicity           "Centred ethnicity (values: -2/+2)"

. 
. * Comorbidities
. label var chronic_respiratory_disease   "Respiratory disease (excl. asthma)"

. label var asthma                                                "Asthma"

. label var chronic_cardiac_disease               "Heart disease"

. label var diabetes                                              "Diabetes"

. label var lung_cancer                                   "Lung cancer"

. label var haem_cancer                                   "Haem. cancer"

. label var other_cancer                                  "Any cancer"

. label var lung_cancer_lastyr                    "Lung cancer in last year"

. label var other_cancer_lastyr                   "Cancer other than lung/haematological in last year"

. 
. label var cancer_exhaem_lastyr                  "Cancer other than haematological in last year"

. label var haem_cancer_lastyr                    "Haem. cancer in last year"

. 
. label var aplanaemia_lastyr                     "Aplastic anaemia in last year"

. label var bone_marrow_transplant_lastyr "Bone marrow transplant in last year"

. 
. label var haemmalig_aanaem_bmtrans_lastyr       "Haematol malignancy, aplastic anaemia or bone marrow transplant in last year"

. 
. label var bone_marrow_transplant                "Organ transplant"

. label var chronic_liver_disease                 "Liver"

. label var stroke_dementia                               "Stroke or dementia"

. label var other_neuro                                   "Neuro condition other than stroke/dementia"    

. label var chronic_kidney_disease                "Kidney disease"

. label var organ_transplant                              "Organ transplant recipient"

. label var dysplenia                                             "Dysplenia"

. label var sickle_cell                                   "Sickle cell"

. label var spleen                                                "Spleen problems (dysplenia, sickle cell)"

. label var ra_sle_psoriasis                              "RA, SLE, Psoriasis (autoimmune disease)"

. label var chemo_radio_therapy                   "Chemotherapy or radiotherapy"

. label var aplastic_anaemia                              "Aplastic anaemia"

. label var hiv                                                   "HIV"

. label var genetic_immunodeficiency              "Genetic immunodeficiency"

. label var immunosuppression_nos                 "Other immunosuppression"

. label var immunosuppressed                              "Immunosuppressed (combination algorithm)"

.  
. label var chronic_respiratory_disease_date      "Respiratory disease (excl. asthma), date"

. label var chronic_cardiac_disease_date  "Heart disease, date"

. label var diabetes_date                                 "Diabetes, date"

. label var lung_cancer_date                              "Lung cancer, date"

. label var haem_cancer_date                              "Haem. cancer, date"

. label var other_cancer_date                             "Any cancer, date"

. label var bone_marrow_transplant_date   "Organ transplant, date"

. label var chronic_liver_disease_date    "Liver, date"

. 
. label var stroke_dementia_date                  "Stroke or dementia, date"

. label var other_neuro_date                              "Neuro condition other than stroke/dementia, date"      

. 
. label var chronic_kidney_disease_date   "Kidney disease, date"

. label var organ_transplant_date                 "Organ transplant recipient, date"

. label var dysplenia_date                                "Splenectomy etc, date"

. label var sickle_cell_date                              "Sickle cell, date"

. label var ra_sle_psoriasis_date                 "RA, SLE, Psoriasis (autoimmune disease), date"

. label var chemo_radio_therapy_date              "Chemotherapy or radiotherapy, date"

. label var aplastic_anaemia_date                 "Aplastic anaemia, date"

. label var hiv_date                                              "HIV, date"

. label var genetic_immunodeficiency_date "Genetic immunodeficiency, date"

. label var immunosuppression_nos_date    "Other immunosuppression, date"

. 
. * Outcomes and follow-up
. label var enter_date            "Date of study entry"

. label var end_study_date        "Date of end of study"

. label var death_date            "Date of death"

. label var died                          "Death from Covid-19"

. label var hosp_date                     "Date of hospitalisation"

. label var hosp                          "Hospitalised for Covid-19"

. label var itu_date                      "Date of hospitalisation"

. label var itu                           "Admitted to ITU for Covid-19"

. 
. * Survival times
. label var  stime_died           "Survival time; outcome death"

. label var  stime_hosp           "Survival time; outcome hospitalisation"

. label var  stime_itu            "Survival time; outcome ITU admission"

. 
. 
. 
. 
. ***************
. *  Save data  *
. ***************
. 
. sort patient_id

. label data "Poor factors dummy analysis dataset"

. save "egdata", replace
file egdata.dta saved

. 
. 
. 
end of do-file

