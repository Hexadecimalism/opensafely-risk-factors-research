
. 
. * Open dataset and fit specified model(s)
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id) 

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. foreach var of any `varlist' {
  2. 
.         *Special cases
.         if "`var'"=="agesplsex" local model "age1 age2 age3 i.male  i.smoke"
  3.         else if "`var'"=="agegroupsex" local model "ib3.agegroup i.male  i.smoke"
  4.         else if "`var'"=="bmicat" local model "age1 age2 age3 i.male ib2.bmicat i.smoke"
  5.         *General form of model
.         else local model "age1 age2 age3 i.male i.`var' i.smoke"
  6. 
.         *Fit and save model
.         cap erase ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var'.ster
  7.         capture stcox `model' , strata(stp) 
  8.         if _rc==0 {
  9.                 estimates
 10.                 estimates save ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var', repla
> ce
 11.                 }
 12.         else di "WARNING - `var' vs `outcome' MODEL DID NOT SUCCESSFULLY FIT"
 13. 
. }

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(8)       =    15259.39
Log likelihood  =   -68515.355                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------
           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
         age1 |   1.111542   .0272994     4.31   0.000     1.059303    1.166356
         age2 |   1.037167   .0565589     0.67   0.503     .9320316    1.154161
         age3 |   .8815319   .1123901    -0.99   0.323     .6866174    1.131778
       1.male |   2.111107   .0594537    26.53   0.000     1.997738     2.23091
              |
    asthmacat |
 Yes, no OCS  |   1.266277   .0510381     5.86   0.000     1.170094    1.370367
Yes with OCS  |   1.727096   .1251826     7.54   0.000     1.498374    1.990733
              |
        smoke |
      Former  |   1.540225   .0461191    14.42   0.000     1.452434    1.633322
     Current  |   1.108761   .0627553     1.82   0.068     .9923398    1.238841
-------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_asthmacat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_asthmacat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(9)       =    15209.45
Log likelihood  =   -68540.325                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------
               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
             age1 |   1.111334   .0273591     4.29   0.000     1.058985    1.166272
             age2 |   1.035718   .0566034     0.64   0.521     .9305128    1.152819
             age3 |   .8849784   .1130567    -0.96   0.339     .6889553    1.136774
           1.male |   2.071291   .0583279    25.86   0.000     1.960068    2.188826
                  |
cancer_exhaem_cat |
       Last year  |   1.548822   .1523215     4.45   0.000     1.277287    1.878081
   2-5 years ago  |   1.223601   .0799513     3.09   0.002     1.076518    1.390779
        5+ years  |   .9767375   .0440943    -0.52   0.602     .8940275    1.067099
                  |
            smoke |
          Former  |   1.551622   .0464497    14.67   0.000     1.463202    1.645385
         Current  |   1.103728   .0624506     1.74   0.081     .9878705    1.233174
-----------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_cancer_exhaem_cat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_cancer_exhaem_cat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(9)       =    15322.39
Log likelihood  =   -68483.858                  Prob > chi2      =      0.0000

---------------------------------------------------------------------------------
             _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------+----------------------------------------------------------------
           age1 |   1.111876   .0273939     4.30   0.000     1.059461    1.166885
           age2 |   1.034158   .0565439     0.61   0.539     .9290655    1.151138
           age3 |   .8879205    .113473    -0.93   0.352     .6911839    1.140656
         1.male |   2.066108   .0581321    25.79   0.000     1.955256    2.183245
                |
cancer_haem_cat |
     Last year  |   3.522478   .6798164     6.52   0.000     2.413079    5.141915
 2-5 years ago  |   3.194075   .3600341    10.30   0.000     2.560933    3.983749
      5+ years  |   1.956619   .1957207     6.71   0.000     1.608276    2.380411
                |
          smoke |
        Former  |   1.552944   .0464718    14.71   0.000      1.46448    1.646751
       Current  |   1.110415   .0628356     1.85   0.064     .9938434     1.24066
---------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_cancer_haem_cat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_cancer_haem_cat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15515.08
Log likelihood  =   -68387.511                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------------------
                       _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------------------+----------------------------------------------------------------
                     age1 |   1.113696   .0274717     4.37   0.000     1.061133    1.168862
                     age2 |   1.027065   .0562251     0.49   0.626     .9225721    1.143394
                     age3 |   .8954862   .1145768    -0.86   0.388     .6968643     1.15072
                   1.male |   1.962421   .0556394    23.78   0.000     1.856345    2.074559
1.chronic_cardiac_disease |   1.720619   .0501087    18.63   0.000     1.625158    1.821687
                          |
                    smoke |
                  Former  |   1.498189   .0449983    13.46   0.000      1.41254    1.589032
                 Current  |   1.083097   .0613141     1.41   0.159     .9693501     1.21019
-------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_cardiac_disease.ster not fou
> nd)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_cardiac_disease.ster saved

. 
. 
. * Open dataset and fit specified model(s)
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id) 

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. foreach var of any `varlist' {
  2. 
.         *Special cases
.         if "`var'"=="agesplsex" local model "age1 age2 age3 i.male  i.smoke"
  3.         else if "`var'"=="agegroupsex" local model "ib3.agegroup i.male  i.smoke"
  4.         else if "`var'"=="bmicat" local model "age1 age2 age3 i.male ib2.bmicat i.smoke"
  5.         *General form of model
.         else local model "age1 age2 age3 i.male i.`var' i.smoke"
  6. 
.         *Fit and save model
.         cap erase ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var'.ster
  7.         capture stcox `model' , strata(stp) 
  8.         if _rc==0 {
  9.                 estimates
 10.                 estimates save ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var', repla
> ce
 11.                 }
 12.         else di "WARNING - `var' vs `outcome' MODEL DID NOT SUCCESSFULLY FIT"
 13. 
. }

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15751.17
Log likelihood  =   -68269.468                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------------------
                      _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------------+----------------------------------------------------------------
                    age1 |   1.101467   .0267096     3.99   0.000     1.050342    1.155081
                    age2 |   1.069056   .0577154     1.24   0.216     .9617155    1.188378
                    age3 |   .7911428   .1000101    -1.85   0.064     .6175223    1.013578
                  1.male |   2.088899   .0587281    26.20   0.000     1.976908    2.207234
1.chronic_kidney_disease |   2.088825   .0640682    24.02   0.000     1.966954    2.218248
                         |
                   smoke |
                 Former  |   1.517851    .045472    13.93   0.000     1.431294    1.609643
                Current  |   1.103667   .0624373     1.74   0.081     .9878327    1.233084
------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_kidney_disease.ster not foun
> d)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_kidney_disease.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15236.79
Log likelihood  =   -68526.654                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------
                     _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                   age1 |    1.11014    .027281     4.25   0.000     1.057938    1.164919
                   age2 |   1.038158   .0566436     0.69   0.492     .9328691    1.155331
                   age3 |   .8808542   .1123589    -0.99   0.320     .6860054    1.131047
                 1.male |   2.081345   .0585434    26.06   0.000     1.969707     2.19931
1.chronic_liver_disease |   2.202463    .210639     8.26   0.000     1.826003    2.656536
                        |
                  smoke |
                Former  |   1.549995   .0463904    14.64   0.000     1.461687    1.643638
               Current  |   1.095766   .0620334     1.62   0.106      .980685    1.224351
-----------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_liver_disease.ster not found
> )
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_liver_disease.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15633.04
Log likelihood  =    -68328.53                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.123382   .0280716     4.66   0.000     1.069688    1.179771
                         age2 |   .9991389   .0552774    -0.02   0.988     .8964644    1.113573
                         age3 |   .9676488   .1249876    -0.25   0.799     .7512271     1.24642
                       1.male |   2.060266   .0579186    25.71   0.000     1.949819     2.17697
1.chronic_respiratory_disease |   2.101509    .069115    22.58   0.000      1.97032    2.241433
                              |
                        smoke |
                      Former  |   1.410806   .0429784    11.30   0.000     1.329036    1.497608
                     Current  |   .9293162   .0532106    -1.28   0.200     .8306643    1.039684
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_respiratory_disease.ster not
>  found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_chronic_respiratory_disease.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(9)       =    16108.93
Log likelihood  =   -68090.585                  Prob > chi2      =      0.0000

---------------------------------------------------------------------------------------------
                         _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
                       age1 |   1.119959   .0279011     4.55   0.000     1.066588    1.176001
                       age2 |    .992641   .0548042    -0.13   0.894     .8908344    1.106082
                       age3 |   .9949385   .1283182    -0.04   0.969     .7727089    1.281081
                     1.male |   1.980815   .0559646    24.19   0.000     1.874108    2.093597
                            |
                    diabcat |
       Controlled diabetes  |   1.867665    .061714    18.91   0.000     1.750541    1.992625
     Uncontrolled diabetes  |   3.226444   .1298881    29.10   0.000     2.981653    3.491333
Diabetes, no hba1c measure  |   2.297515   .1526492    12.52   0.000      2.01699    2.617056
                            |
                      smoke |
                    Former  |   1.485121   .0446337    13.16   0.000     1.400167    1.575229
                   Current  |   1.090078   .0617118     1.52   0.128      .975594    1.217997
---------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_diabcat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_diabcat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,541,963                  Number of obs    =  12,541,963
No. of failures =        4,234
Time at risk    =   1052285536
                                                LR chi2(10)      =    11507.61
Log likelihood  =   -49989.219                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------
                     _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                   age1 |   1.092097   .0293928     3.27   0.001     1.035982    1.151253
                   age2 |   1.085535   .0653384     1.36   0.173     .9647391    1.221455
                   age3 |    .790781   .1116265    -1.66   0.096      .599654    1.042826
                 1.male |   2.014224   .0655562    21.51   0.000     1.889749    2.146899
                        |
              ethnicity |
                 Mixed  |   1.929774   .3132446     4.05   0.000     1.403906    2.652621
Asian or Asian British  |    2.15353   .1283273    12.87   0.000     1.916145    2.420323
                 Black  |   2.303897   .1964079     9.79   0.000     1.949386    2.722878
                 Other  |   1.478421   .1939949     2.98   0.003     1.143156    1.912013
                        |
                  smoke |
                Former  |   1.664447   .0589958    14.37   0.000     1.552743    1.784188
               Current  |   1.206795   .0783643     2.89   0.004     1.062576    1.370589
-----------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_ethnicity.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_ethnicity.ster saved

. 
. * Open dataset and fit specified model(s)
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id) 

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. foreach var of any `varlist' {
  2. 
.         *Special cases
.         if "`var'"=="agesplsex" local model "age1 age2 age3 i.male  i.smoke"
  3.         else if "`var'"=="agegroupsex" local model "ib3.agegroup i.male  i.smoke"
  4.         else if "`var'"=="bmicat" local model "age1 age2 age3 i.male ib2.bmicat i.smoke"
  5.         *General form of model
.         else local model "age1 age2 age3 i.male i.`var' i.smoke"
  6. 
.         *Fit and save model
.         cap erase ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var'.ster
  7.         capture stcox `model' , strata(stp) 
  8.         if _rc==0 {
  9.                 estimates
 10.                 estimates save ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var', repla
> ce
 11.                 }
 12.         else di "WARNING - `var' vs `outcome' MODEL DID NOT SUCCESSFULLY FIT"
 13. 
. }

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15216.85
Log likelihood  =   -68536.626                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------------
                _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
              age1 |   1.110778     .02736     4.27   0.000     1.058427    1.165718
              age2 |   1.029693   .0563159     0.54   0.593     .9250261    1.146203
              age3 |   .8998622   .1150589    -0.83   0.409     .7003885    1.156147
            1.male |   2.085924   .0587024    26.12   0.000     1.973985    2.204211
1.htdiag_or_highbp |   1.199851   .0380919     5.74   0.000     1.127467    1.276881
                   |
             smoke |
           Former  |   1.547466   .0463329    14.58   0.000     1.459268    1.640994
          Current  |   1.108832   .0627499     1.83   0.068     .9924194    1.238899
------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_htdiag_or_highbp.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_htdiag_or_highbp.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   15,468,830                  Number of obs    =  15,468,830
No. of failures =        5,668
Time at risk    =   1297634892
                                                LR chi2(9)       =    14669.65
Log likelihood  =   -68258.672                  Prob > chi2      =      0.0000

---------------------------------------------------------------------------------
             _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------+----------------------------------------------------------------
           age1 |    1.11115   .0293085     4.00   0.000     1.055166    1.170105
           age2 |   1.046291   .0604914     0.78   0.434      .934201    1.171831
           age3 |   .8559927   .1150651    -1.16   0.247      .657732    1.114015
         1.male |   2.082585   .0585823    26.08   0.000     1.970874    2.200628
                |
          bpcat |
      Elevated  |   .7089716   .0308746    -7.90   0.000      .650969    .7721424
 High, stage I  |   .5928561    .022328   -13.88   0.000     .5506702    .6382738
High, stage II  |   .5491234   .0209519   -15.71   0.000     .5095564    .5917628
                |
          smoke |
        Former  |   1.534749   .0459902    14.30   0.000     1.447206    1.627588
       Current  |    1.08937   .0617703     1.51   0.131     .9747875    1.217421
---------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_bpcat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_bpcat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15337.34
Log likelihood  =   -68476.381                  Prob > chi2      =      0.0000

--------------------------------------------------------------------------------
            _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
          age1 |   1.116436   .0276919     4.44   0.000     1.063459    1.172052
          age2 |   1.009911   .0555711     0.18   0.858     .9066618    1.124919
          age3 |   .9430947   .1212537    -0.46   0.649     .7330209    1.213373
        1.male |   2.089934   .0588672    26.17   0.000     1.977683    2.208556
1.hypertension |   1.438036   .0427726    12.21   0.000       1.3566     1.52436
               |
         smoke |
       Former  |   1.528115   .0458055    14.15   0.000     1.440924    1.620582
      Current  |   1.115005   .0631092     1.92   0.054     .9979271    1.245818
--------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_hypertension.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_hypertension.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,559,800                  Number of obs    =  16,559,800
No. of failures =        5,644
Time at risk    =   1389280249
                                                LR chi2(10)      =    15395.31
Log likelihood  =   -67956.681                  Prob > chi2      =      0.0000

----------------------------------------------------------------------------------
              _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
            age1 |   1.108764   .0271242     4.22   0.000     1.056856    1.163222
            age2 |   1.049091   .0570714     0.88   0.378     .9429897    1.167129
            age3 |   .8536525   .1086436    -1.24   0.214     .6651957    1.095501
          1.male |   2.110307   .0595907    26.45   0.000     1.996684    2.230395
                 |
             imd |
              2  |   1.186282    .053454     3.79   0.000     1.086007    1.295815
              3  |   1.333411   .0598966     6.41   0.000     1.221036    1.456129
              4  |   1.721749   .0758597    12.33   0.000     1.579306     1.87704
5 most deprived  |   2.165937   .0972779    17.21   0.000     1.983427    2.365242
                 |
           smoke |
         Former  |    1.51434   .0455519    13.80   0.000      1.42764    1.606304
        Current  |   .9819181   .0560322    -0.32   0.749     .8780156    1.098116
----------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_imd.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_imd.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(9)       =    15669.42
Log likelihood  =   -68310.341                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------------
                 _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------------+----------------------------------------------------------------
               age1 |   1.109637   .0273687     4.22   0.000     1.057272    1.164597
               age2 |   1.025787   .0561439     0.47   0.642     .9214436    1.141946
               age3 |   .9253148    .118386    -0.61   0.544     .7200881    1.189031
             1.male |   2.176358   .0615455    27.50   0.000     2.059014    2.300391
                    |
          obese4cat |
 Obese I (30-34.9)  |   1.521452   .0516269    12.37   0.000     1.423557     1.62608
Obese II (35-39.9)  |   2.099752   .1042354    14.94   0.000     1.905079    2.314319
   Obese III (40+)  |   3.327171   .2176853    18.37   0.000     2.926738    3.782389
                    |
              smoke |
            Former  |    1.49539    .044882    13.41   0.000     1.409961    1.585996
           Current  |   1.148206   .0650312     2.44   0.015     1.027567    1.283009
-------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_obese4cat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_obese4cat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   13,580,692                  Number of obs    =  13,580,692
No. of failures =        5,196
Time at risk    =   1139209823
                                                LR chi2(11)      =    13635.24
Log likelihood  =   -61801.484                  Prob > chi2      =      0.0000

---------------------------------------------------------------------------------------
                   _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------+----------------------------------------------------------------
                 age1 |   1.099405   .0307788     3.39   0.001     1.040705    1.161416
                 age2 |   1.047126   .0645008     0.75   0.455       .92804    1.181493
                 age3 |   .8833595    .126713    -0.86   0.387     .6668642    1.170139
               1.male |   2.295928   .0686469    27.80   0.000     2.165248    2.434493
                      |
               bmicat |
 Underweight (<18.5)  |   1.596743   .1334752     5.60   0.000     1.355443       1.881
Overweight (25-29.9)  |   .9558331   .0345496    -1.25   0.211     .8904602    1.026005
   Obese I (30-34.9)  |   1.519285   .0607516    10.46   0.000      1.40476    1.643146
  Obese II (35-39.9)  |   2.109152   .1140098    13.81   0.000     1.897127    2.344873
     Obese III (40+)  |   3.361503   .2318155    17.58   0.000     2.936521     3.84799
                      |
                smoke |
              Former  |   1.478549   .0467904    12.36   0.000     1.389628     1.57316
             Current  |    1.18512   .0704239     2.86   0.004     1.054826    1.331507
---------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_bmicat.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_bmicat.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15290.60
Log likelihood  =   -68499.752                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------------
                _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
              age1 |   1.109424    .027232     4.23   0.000     1.057314    1.164103
              age2 |   1.040382   .0567126     0.73   0.468     .9349594    1.157692
              age3 |   .8761016   .1116604    -1.04   0.299     .6824449    1.124712
            1.male |   2.078248   .0584617    26.00   0.000     1.966767    2.196048
1.organ_transplant |   7.110227   1.022004    13.65   0.000     5.364561    9.423945
                   |
             smoke |
           Former  |    1.55547   .0465433    14.76   0.000      1.46687    1.649421
          Current  |   1.111417   .0628902     1.87   0.062     .9947436    1.241774
------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_organ_transplant.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_organ_transplant.ster saved


. 
. * Open dataset and fit specified model(s)
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id) 

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. foreach var of any `varlist' {
  2. 
.         *Special cases
.         if "`var'"=="agesplsex" local model "age1 age2 age3 i.male  i.smoke"
  3.         else if "`var'"=="agegroupsex" local model "ib3.agegroup i.male  i.smoke"
  4.         else if "`var'"=="bmicat" local model "age1 age2 age3 i.male ib2.bmicat i.smoke"
  5.         *General form of model
.         else local model "age1 age2 age3 i.male i.`var' i.smoke"
  6. 
.         *Fit and save model
.         cap erase ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var'.ster
  7.         capture stcox `model' , strata(stp) 
  8.         if _rc==0 {
  9.                 estimates
 10.                 estimates save ./output/models/an_smok_exp_cox_models_`outcome'_AGESEX_`var', repla
> ce
 11.                 }
 12.         else di "WARNING - `var' vs `outcome' MODEL DID NOT SUCCESSFULLY FIT"
 13. 
. }

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15196.50
Log likelihood  =   -68546.801                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------------------
                       _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------------------+----------------------------------------------------------------
                     age1 |   1.109292   .0273076     4.21   0.000      1.05704    1.164126
                     age2 |   1.043942   .0570533     0.79   0.431     .9379002    1.161973
                     age3 |    .866474   .1106996    -1.12   0.262      .674539    1.113023
                   1.male |   2.083536   .0585966    26.10   0.000     1.971797    2.201608
1.other_immunosuppression |   1.983377    .333115     4.08   0.000     1.427062     2.75656
                          |
                    smoke |
                  Former  |   1.555014   .0465302    14.75   0.000     1.466439    1.648938
                 Current  |   1.105846   .0625706     1.78   0.075     .9897656    1.235541
-------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_other_immunosuppression.ster not fou
> nd)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_other_immunosuppression.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15403.66
Log likelihood  =   -68443.222                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------
           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
         age1 |   1.112284   .0274245     4.32   0.000     1.059811    1.167355
         age2 |   1.032609   .0564937     0.59   0.558     .9276128    1.149489
         age3 |   .8912485    .113962    -0.90   0.368     .6936774    1.145091
       1.male |   2.063777   .0580451    25.76   0.000      1.95309    2.180738
1.other_neuro |   2.718116   .1590991    17.08   0.000      2.42351    3.048536
              |
        smoke |
      Former  |   1.556656   .0465757    14.79   0.000     1.467994    1.650672
     Current  |   1.114569   .0630795     1.92   0.055     .9975454     1.24532
-------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_other_neuro.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_other_neuro.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15218.98
Log likelihood  =   -68535.563                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------------
                _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
              age1 |   1.110501    .027313     4.26   0.000     1.058238    1.165345
              age2 |   1.037426   .0566433     0.67   0.501     .9321409    1.154603
              age3 |   .8819017   .1125641    -0.98   0.325      .686712    1.132572
            1.male |   2.092883   .0588779    26.25   0.000     1.980608    2.211522
1.ra_sle_psoriasis |     1.3294   .0607752     6.23   0.000     1.215464    1.454017
                   |
             smoke |
           Former  |   1.543125   .0462275    14.48   0.000      1.45513    1.636442
          Current  |   1.096066   .0620375     1.62   0.105     .9809768    1.224658
------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_ra_sle_psoriasis.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_ra_sle_psoriasis.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15188.42
Log likelihood  =   -68550.841                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        age1 |   1.109692   .0272474     4.24   0.000     1.057553    1.164402
        age2 |   1.040901   .0567535     0.74   0.462     .9354034    1.158297
        age3 |   .8736835   .1113726    -1.06   0.289     .6805302    1.121659
      1.male |    2.08284   .0585771    26.09   0.000     1.971138    2.200873
    1.spleen |   1.694555   .3540845     2.52   0.012     1.125106    2.552218
             |
       smoke |
     Former  |   1.555116   .0465348    14.76   0.000     1.466532     1.64905
    Current  |   1.105493   .0625508     1.77   0.076     .9894488    1.235146
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_spleen.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_spleen.ster saved

--------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,691,344                  Number of obs    =  16,691,344
No. of failures =        5,677
Time at risk    =   1400321978
                                                LR chi2(7)       =    15595.39
Log likelihood  =   -68347.358                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------
               _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
             age1 |   1.106795   .0270445     4.15   0.000     1.055038    1.161091
             age2 |   1.049538   .0570092     0.89   0.373     .9435446    1.167439
             age3 |   .8470142   .1076319    -1.31   0.191     .6602779    1.086562
           1.male |   2.050409   .0577121    25.51   0.000     1.940359    2.166701
1.stroke_dementia |   2.193475   .0785516    21.93   0.000     2.044796    2.352965
                  |
            smoke |
          Former  |   1.530795   .0458461    14.22   0.000     1.443525    1.623342
         Current  |   1.080325   .0611456     1.37   0.172     .9668899    1.207068
-----------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_stroke_dementia.ster not found)
file ./output/models/an_smok_exp_cox_models_cpnsdeath_AGESEX_stroke_dementia.ster saved
