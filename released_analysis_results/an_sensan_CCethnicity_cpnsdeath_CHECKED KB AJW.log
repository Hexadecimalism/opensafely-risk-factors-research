-------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_sensan_CCethnicity_cpnsdeath.log
  log type:  text
 opened on:   5 May 2020, 22:21:50

. 
. *an_sensan_CCethnicity_cpnsdeath
. use "cr_create_analysis_dataset_STSET_cpnsdeath.dta", clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. drop if ethnicity>=.
(4,592,377 observations deleted)

. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. *Complete case ethnicity model
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2018.73 /        1 =    2018.7280

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(39)      =    13792.96
Log likelihood  =   -48498.596                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.120663   .0306375     4.17   0.000     1.062195    1.182349
                         age2 |   .9797685   .0597996    -0.33   0.738     .8693024    1.104272
                         age3 |   1.010457   .1446194     0.07   0.942      .763293    1.337655
                       1.male |   1.925541   .0642042    19.65   0.000     1.803726    2.055582
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.279157   .0508365     6.19   0.000     1.183301    1.382778
          Obese II (35-39.9)  |   1.603993   .0929438     8.15   0.000      1.43179    1.796907
             Obese III (40+)  |   2.277036   .1761869    10.63   0.000     1.956626    2.649916
                              |
                 smoke_nomiss |
                      Former  |   1.317545   .0480539     7.56   0.000     1.226648    1.415177
                     Current  |   .9356982   .0624571    -1.00   0.319      .820954     1.06648
                              |
                    ethnicity |
                       Mixed  |   1.642722   .2671506     3.05   0.002     1.194361    2.259395
      Asian or Asian British  |   1.615036   .0988853     7.83   0.000     1.432402    1.820956
                       Black  |   1.709573   .1476413     6.21   0.000     1.443366    2.024877
                       Other  |   1.333145    .178233     2.15   0.031     1.025834    1.732517
                              |
                          imd |
                           2  |   1.192636   .0646169     3.25   0.001     1.072482    1.326252
                           3  |   1.257475   .0678883     4.24   0.000     1.131215    1.397829
                           4  |   1.534668   .0809486     8.12   0.000     1.383937    1.701816
             5 most deprived  |   1.696028   .0918982     9.75   0.000     1.525145    1.886057
                              |
           1.htdiag_or_highbp |   .9732202   .0370276    -0.71   0.476     .9032874    1.048567
1.chronic_respiratory_disease |   1.790201   .0700698    14.88   0.000     1.658002     1.93294
                              |
                    asthmacat |
                 Yes, no OCS  |   1.030297   .0488762     0.63   0.529     .9388197    1.130687
                Yes with OCS  |   1.243591   .1018709     2.66   0.008     1.059132    1.460176
                              |
    1.chronic_cardiac_disease |   1.271277   .0441892     6.91   0.000     1.187552    1.360904
                              |
                      diabcat |
         Controlled diabetes  |   1.472856   .0579734     9.84   0.000     1.363502    1.590979
       Uncontrolled diabetes  |    2.22842   .1075289    16.61   0.000     2.027327    2.449461
  Diabetes, no hba1c measure  |   1.908091   .1541373     8.00   0.000     1.628689    2.235424
                              |
            cancer_exhaem_cat |
                   Last year  |   1.683502   .1863622     4.71   0.000     1.355147    2.091418
               2-5 years ago  |   1.207385   .0924445     2.46   0.014     1.039137    1.402875
                    5+ years  |   1.016517   .0531144     0.31   0.754      .917568    1.126137
                              |
              cancer_haem_cat |
                   Last year  |   3.295627   .7587788     5.18   0.000     2.098742     5.17508
               2-5 years ago  |   3.419339   .4317136     9.74   0.000     2.669762    4.379372
                    5+ years  |   1.843022   .2169642     5.19   0.000     1.463273    2.321323
                              |
      1.chronic_liver_disease |   1.610493   .1770477     4.33   0.000     1.298324     1.99772
            1.stroke_dementia |   1.749955   .0748498    13.08   0.000     1.609233    1.902983
                1.other_neuro |   2.412256    .166431    12.76   0.000     2.107151    2.761539
     1.chronic_kidney_disease |   1.761958   .0636301    15.68   0.000     1.641557    1.891191
           1.organ_transplant |   4.587204   .7306946     9.56   0.000      3.35707    6.268098
                     1.spleen |   1.429044    .338403     1.51   0.132     .8984172    2.273073
           1.ra_sle_psoriasis |   1.167755   .0634628     2.85   0.004     1.049766    1.299006
    1.other_immunosuppression |   1.661847   .3065947     2.75   0.006     1.157584    2.385775
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCe
> th, replace
(note: file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.st
> er not found)
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster save
> d
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"

.  
.  
. *Model without ethnicity among ethnicity complete cases 
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(0) if("if ethnicity<.")
   1:   1763.69 /        1 =    1763.6860

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(35)      =    13708.26
Log likelihood  =   -48540.945                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.124485   .0308262     4.28   0.000     1.065661    1.186555
                         age2 |   .9657529   .0590747    -0.57   0.569       .85664    1.088764
                         age3 |   1.048834   .1504073     0.33   0.740     .7918459    1.389225
                       1.male |   1.946036   .0647759    20.00   0.000     1.823131    2.077228
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.260769   .0500793     5.83   0.000     1.166339    1.362844
          Obese II (35-39.9)  |   1.561921   .0904049     7.70   0.000     1.394412    1.749553
             Obese III (40+)  |   2.190921   .1692819    10.15   0.000     1.883036    2.549148
                              |
                 smoke_nomiss |
                      Former  |   1.252116   .0449058     6.27   0.000     1.167125    1.343297
                     Current  |   .8827771   .0586074    -1.88   0.060     .7750683    1.005454
                              |
                          imd |
                           2  |   1.194525   .0647201     3.28   0.001     1.074179    1.328354
                           3  |   1.276966   .0688777     4.53   0.000     1.148859    1.419357
                           4  |   1.588136   .0834658     8.80   0.000      1.43269    1.760448
             5 most deprived  |   1.800565   .0966208    10.96   0.000      1.62081    2.000255
                              |
           1.htdiag_or_highbp |   .9792482   .0372394    -0.55   0.581     .9089141    1.055025
1.chronic_respiratory_disease |   1.767584   .0691467    14.56   0.000     1.637124     1.90844
                              |
                    asthmacat |
                 Yes, no OCS  |   1.043968   .0494836     0.91   0.364     .9513509    1.145602
                Yes with OCS  |   1.270054   .1039797     2.92   0.004     1.081768    1.491112
                              |
    1.chronic_cardiac_disease |   1.272836   .0442104     6.95   0.000     1.189069    1.362504
                              |
                      diabcat |
         Controlled diabetes  |   1.534959   .0598754    10.99   0.000     1.421979    1.656915
       Uncontrolled diabetes  |   2.357079   .1125323    17.96   0.000     2.146524    2.588286
  Diabetes, no hba1c measure  |   2.003733   .1613629     8.63   0.000     1.711164    2.346325
                              |
            cancer_exhaem_cat |
                   Last year  |   1.658301   .1835344     4.57   0.000     1.334921    2.060018
               2-5 years ago  |   1.190142   .0910883     2.27   0.023     1.024358    1.382758
                    5+ years  |   1.002495   .0523214     0.05   0.962     .9050172    1.110471
                              |
              cancer_haem_cat |
                   Last year  |   3.309047   .7618407     5.20   0.000     2.107323    5.196067
               2-5 years ago  |   3.411253   .4306712     9.72   0.000     2.663481    4.368961
                    5+ years  |   1.825078   .2148579     5.11   0.000     1.449017    2.298738
                              |
      1.chronic_liver_disease |   1.596239   .1755139     4.25   0.000      1.28678     1.98012
            1.stroke_dementia |   1.752175   .0749195    13.12   0.000      1.61132    1.905343
                1.other_neuro |   2.412308    .166365    12.77   0.000     2.107315    2.761442
     1.chronic_kidney_disease |   1.769798   .0639504    15.80   0.000     1.648793    1.899683
           1.organ_transplant |   4.717099   .7512932     9.74   0.000     3.452264    6.445343
                     1.spleen |   1.438037   .3405123     1.53   0.125     .9040953    2.287314
           1.ra_sle_psoriasis |   1.156299   .0628118     2.67   0.008     1.039518    1.286201
    1.other_immunosuppression |   1.722786   .3174144     2.95   0.003     1.200609     2.47207
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCn
> oeth, replace
(note: file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCnoeth.
> ster not found)
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCnoeth.ster sa
> ved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC MODEL (excluding ethnicity) DID NOT FIT (OUTCOME `outcome')"

.  
. 
.  *Complete case ethnicity model with age group
. basecoxmodel, age("ib3.agegroup") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2172.16 /        1 =    2172.1640

. if _rc==0{
. estimates

-------------------------------------------------------------------------------------------------------
active results
-------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,719,249                  Number of obs    =  12,719,249
No. of failures =        4,203
Time at risk    =   1067136353
                                                LR chi2(41)      =    13401.16
Log likelihood  =   -48694.496                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                     agegroup |
                      18-<40  |   .0803284   .0146646   -13.81   0.000     .0561662     .114885
                      40-<50  |   .2969353   .0387448    -9.31   0.000     .2299297    .3834675
                      60-<70  |   2.069165   .1542617     9.75   0.000      1.78787    2.394719
                      70-<80  |   4.810982   .3347853    22.57   0.000     4.197595    5.514002
                         80+  |   12.04052   .8575042    34.94   0.000     10.47187    13.84415
                              |
                       1.male |   1.837777   .0609668    18.34   0.000     1.722086     1.96124
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.202156   .0475048     4.66   0.000     1.112563    1.298965
          Obese II (35-39.9)  |   1.475602   .0850899     6.75   0.000     1.317908    1.652165
             Obese III (40+)  |   2.055776   .1583819     9.35   0.000     1.767654    2.390861
                              |
                 smoke_nomiss |
                      Former  |   1.321203   .0482396     7.63   0.000     1.229959    1.419216
                     Current  |   .8843261   .0588587    -1.85   0.065     .7761729     1.00755
                              |
                    ethnicity |
                       Mixed  |   1.587888   .2582582     2.84   0.004     1.154459    2.184045
      Asian or Asian British  |   1.565061   .0958539     7.31   0.000     1.388029    1.764672
                       Black  |   1.651868   .1426999     5.81   0.000     1.394577    1.956627
                       Other  |   1.300753   .1739071     1.97   0.049     1.000902    1.690434
                              |
                          imd |
                           2  |   1.192781   .0646247     3.25   0.001     1.072612    1.326412
                           3  |   1.257577   .0679085     4.24   0.000     1.131281    1.397974
                           4  |   1.533319    .080921     8.10   0.000     1.382644    1.700414
             5 most deprived  |   1.692702   .0917365     9.71   0.000     1.522121    1.882399
                              |
           1.htdiag_or_highbp |   1.010778   .0385495     0.28   0.779     .9379772    1.089229
1.chronic_respiratory_disease |    1.78727   .0701231    14.80   0.000     1.654983    1.930131
                              |
                    asthmacat |
                 Yes, no OCS  |   1.014129   .0480967     0.30   0.767     .9241094    1.112917
                Yes with OCS  |   1.220789   .0999646     2.44   0.015     1.039776    1.433314
                              |
    1.chronic_cardiac_disease |   1.316623   .0458864     7.89   0.000     1.229691    1.409702
                              |
                      diabcat |
         Controlled diabetes  |   1.457624   .0575141     9.55   0.000     1.349147    1.574823
       Uncontrolled diabetes  |   2.154936   .1040586    15.90   0.000     1.960339     2.36885
  Diabetes, no hba1c measure  |    1.97099   .1592554     8.40   0.000     1.682316    2.309199
                              |
            cancer_exhaem_cat |
                   Last year  |   1.676783   .1856235     4.67   0.000      1.34973    2.083083
               2-5 years ago  |   1.200938   .0919821     2.39   0.017     1.033536    1.395455
                    5+ years  |   1.033582   .0540477     0.63   0.528      .932898    1.145132
                              |
              cancer_haem_cat |
                   Last year  |   3.233935   .7445102     5.10   0.000     2.059536    5.078007
               2-5 years ago  |   3.338359   .4215465     9.55   0.000     2.606446    4.275799
                    5+ years  |   1.829089   .2153473     5.13   0.000     1.452175    2.303832
                              |
      1.chronic_liver_disease |   1.565938   .1719033     4.09   0.000     1.262794    1.941853
            1.stroke_dementia |   1.831057   .0783294    14.14   0.000     1.683794    1.991199
                1.other_neuro |   2.366792   .1634395    12.48   0.000     2.067189    2.709818
     1.chronic_kidney_disease |   1.960945   .0696882    18.95   0.000     1.829007    2.102401
           1.organ_transplant |   4.188375   .6664872     9.00   0.000     3.066166     5.72131
                     1.spleen |   1.393168   .3298903     1.40   0.161     .8758837    2.215955
           1.ra_sle_psoriasis |   1.148346   .0623984     2.55   0.011     1.032334    1.277394
    1.other_immunosuppression |    1.59082   .2933316     2.52   0.012     1.108326    2.283359
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_CCet
> h, replace
(note: file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_CCeth.ste
> r not found)
file ./output/models/an_sensan_CCethnicity_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_CCeth.ster saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGEGROUP DID NOT FIT (OUTCOME `outcome')"

.  
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-3\analysis\output/an_sensan_CCethnicity_cpnsdeath.log
  log type:  text
 closed on:   6 May 2020, 00:01:41
-------------------------------------------------------------------------------------------------------
