--------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/an_multivariable_cox_models_cpnsdeath.log
  log type:  text
 opened on:   1 May 2020, 18:31:47

. 
. use "cr_create_analysis_dataset_STSET_`outcome'.dta", clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. 
. *Age spline model (not adj ethnicity)
. basecoxmodel, age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0)
   1:   2524.89 /        1 =    2524.8920

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,284,549                  Number of obs    =  17,284,549
No. of failures =        5,674
Time at risk    =   1450148718
                                                LR chi2(35)      =    18496.23
Log likelihood  =    -67060.03                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.133752   .0275635     5.16   0.000     1.080995    1.189083
                         age2 |   .9559775   .0517433    -0.83   0.406     .8597565    1.062967
                         age3 |   1.068498   .1354484     0.52   0.601     .8334333    1.369861
                       1.male |   1.974864   .0566948    23.70   0.000     1.866813     2.08917
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.269188   .0438829     6.89   0.000     1.186029    1.358178
          Obese II (35-39.9)  |   1.563049   .0793089     8.80   0.000     1.415085    1.726483
             Obese III (40+)  |   2.264135   .1514857    12.21   0.000     1.985872    2.581388
                              |
                 smoke_nomiss |
                      Former  |   1.258286   .0386241     7.48   0.000     1.184816    1.336311
                     Current  |   .8805916   .0508254    -2.20   0.028     .7864036    .9860606
                              |
                          imd |
                           2  |    1.14455   .0514699     3.00   0.003     1.047989    1.250008
                           3  |   1.222405   .0549105     4.47   0.000     1.119384    1.334908
                           4  |   1.494762   .0659907     9.10   0.000      1.37086    1.629862
             5 most deprived  |   1.740349   .0787277    12.25   0.000     1.592689      1.9017
                              |
           1.htdiag_or_highbp |   .9559873   .0309098    -1.39   0.164     .8972848     1.01853
1.chronic_respiratory_disease |   1.778106   .0602833    16.98   0.000     1.663793    1.900273
                              |
                    asthmacat |
                 Yes, no OCS  |   1.106755   .0449781     2.50   0.013     1.022019    1.198517
                Yes with OCS  |   1.225445   .0904476     2.75   0.006     1.060397    1.416183
                              |
    1.chronic_cardiac_disease |   1.263832   .0377536     7.84   0.000     1.191961    1.340036
                              |
                      diabcat |
         Controlled diabetes  |   1.510013   .0512497    12.14   0.000     1.412834    1.613877
       Uncontrolled diabetes  |   2.366587   .0989485    20.60   0.000     2.180385    2.568691
  Diabetes, no hba1c measure  |   1.862576   .1249894     9.27   0.000     1.633027    2.124391
                              |
            cancer_exhaem_cat |
                   Last year  |   1.507895   .1477314     4.19   0.000     1.244449    1.827111
               2-5 years ago  |    1.18097   .0775219     2.53   0.011     1.038398    1.343117
                    5+ years  |   .9638885   .0436145    -0.81   0.416     .8820867    1.053276
                              |
              cancer_haem_cat |
                   Last year  |   3.420364   .6606129     6.37   0.000      2.34245    4.994297
               2-5 years ago  |   3.073307   .3489048     9.89   0.000     2.460204    3.839199
                    5+ years  |   1.856286   .1870346     6.14   0.000     1.523631    2.261568
                              |
      1.chronic_liver_disease |   1.608996   .1564257     4.89   0.000     1.329847    1.946741
            1.stroke_dementia |   1.796198   .0654001    16.09   0.000     1.672483    1.929064
                1.other_neuro |   2.431553   .1434554    15.06   0.000     2.166033    2.729622
     1.chronic_kidney_disease |   1.696217   .0524607    17.08   0.000      1.59645    1.802218
           1.organ_transplant |   4.232753   .6216051     9.82   0.000     3.174087    5.644519
                     1.spleen |   1.393979   .2919409     1.59   0.113     .9246748     2.10147
           1.ra_sle_psoriasis |   1.221728   .0562562     4.35   0.000     1.116297    1.337117
    1.other_immunosuppression |   1.680242      .2823     3.09   0.002     1.208816    2.335519
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmicat_noeth, repl
> ace
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster not f
> ound)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING AGE SPLINE MODEL DID NOT FIT (OUTCOME `outcome')"

.  
. *Age group model (not adj ethnicity)
. basecoxmodel, age("ib3.agegroup") bp("i.htdiag_or_highbp") ethnicity(0)
   1:   2835.94 /        1 =    2835.9400

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   17,284,549                  Number of obs    =  17,284,549
No. of failures =        5,674
Time at risk    =   1450148718
                                                LR chi2(37)      =    17992.70
Log likelihood  =   -67311.795                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                     agegroup |
                      18-<40  |   .0710537   .0118996   -15.79   0.000      .051172    .0986599
                      40-<50  |   .3075212   .0359155   -10.10   0.000     .2446037    .3866226
                      60-<70  |   2.106811   .1386626    11.32   0.000     1.851837    2.396893
                      70-<80  |   4.788542   .2936381    25.54   0.000     4.246262    5.400075
                         80+  |   12.56787   .7817937    40.69   0.000      11.1253    14.19748
                              |
                       1.male |   1.880619   .0536992    22.12   0.000     1.778261    1.988868
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.192884   .0409839     5.13   0.000     1.115202    1.275977
          Obese II (35-39.9)  |   1.440952    .072727     7.24   0.000     1.305234    1.590783
             Obese III (40+)  |   2.053507   .1367663    10.80   0.000     1.802208    2.339846
                              |
                 smoke_nomiss |
                      Former  |    1.26347   .0388355     7.61   0.000     1.189601    1.341925
                     Current  |   .8352996   .0480628    -3.13   0.002     .7462159    .9350182
                              |
                          imd |
                           2  |   1.147083   .0515849     3.05   0.002     1.050306    1.252777
                           3  |   1.225388   .0550567     4.52   0.000     1.122094    1.338191
                           4  |   1.496655   .0661174     9.13   0.000     1.372519    1.632018
             5 most deprived  |    1.73616   .0785879    12.19   0.000     1.588765    1.897229
                              |
           1.htdiag_or_highbp |   .9862433   .0319821    -0.43   0.669       .92551    1.050962
1.chronic_respiratory_disease |   1.770114    .060145    16.81   0.000     1.656072     1.89201
                              |
                    asthmacat |
                 Yes, no OCS  |   1.086622    .044143     2.04   0.041     1.003458    1.176678
                Yes with OCS  |   1.199386   .0884988     2.46   0.014      1.03789     1.38601
                              |
    1.chronic_cardiac_disease |   1.303277    .039029     8.85   0.000     1.228983    1.382062
                              |
                      diabcat |
         Controlled diabetes  |   1.482204   .0504046    11.57   0.000     1.386633    1.584362
       Uncontrolled diabetes  |   2.270271   .0949066    19.61   0.000     2.091674    2.464118
  Diabetes, no hba1c measure  |    1.91287   .1284086     9.66   0.000     1.677047    2.181853
                              |
            cancer_exhaem_cat |
                   Last year  |   1.501653   .1471239     4.15   0.000     1.239291    1.819557
               2-5 years ago  |   1.171572   .0769308     2.41   0.016      1.03009    1.332486
                    5+ years  |   .9803192   .0443864    -0.44   0.661     .8970718    1.071292
                              |
              cancer_haem_cat |
                   Last year  |   3.345302   .6460767     6.25   0.000     2.291095    4.884583
               2-5 years ago  |   2.975808   .3378823     9.60   0.000     2.382083    3.717517
                    5+ years  |   1.835858   .1849906     6.03   0.000     1.506842    2.236715
                              |
      1.chronic_liver_disease |   1.563892   .1518409     4.61   0.000     1.292892    1.891696
            1.stroke_dementia |   1.877442   .0683479    17.30   0.000      1.74815    2.016296
                1.other_neuro |    2.37615   .1403009    14.66   0.000     2.116481    2.667679
     1.chronic_kidney_disease |   1.877549   .0571734    20.69   0.000      1.76877    1.993019
           1.organ_transplant |    3.88149   .5695575     9.24   0.000      2.91136    5.174889
                     1.spleen |   1.364311   .2856966     1.48   0.138      .905035    2.056653
           1.ra_sle_psoriasis |   1.201886   .0553341     3.99   0.000     1.098183    1.315383
    1.other_immunosuppression |   1.604591    .269439     2.82   0.005     1.154603    2.229955
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agegroup_bmicat_noeth, repla
> ce
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster not fo
> und)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agegroup_bmicat_noeth.ster saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"

. 
. *Complete case ethnicity model
. basecoxmodel, age("age1 age2 age3") bp("i.htdiag_or_highbp") ethnicity(1)
   1:   2238.04 /        1 =    2238.0420

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,715,040                  Number of obs    =  12,715,040
No. of failures =        4,221
Time at risk    =   1066826984
                                                LR chi2(39)      =    13761.82
Log likelihood  =   -48756.708                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.116538    .030423     4.05   0.000     1.058474    1.177787
                         age2 |   .9909832   .0603231    -0.15   0.882     .8795326    1.116556
                         age3 |   .9802833   .1399673    -0.14   0.889     .7409944    1.296846
                       1.male |   1.920593   .0638921    19.62   0.000     1.799362    2.049992
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.285231   .0509499     6.33   0.000     1.189152    1.389073
          Obese II (35-39.9)  |   1.610031   .0930352     8.24   0.000     1.437632    1.803103
             Obese III (40+)  |   2.273401   .1758416    10.62   0.000      1.95361     2.64554
                              |
                 smoke_nomiss |
                      Former  |   1.325941   .0482907     7.75   0.000     1.234592    1.424049
                     Current  |   .9381515   .0623777    -0.96   0.337     .8235246    1.068733
                              |
                    ethnicity |
                       Mixed  |    1.64455   .2674297     3.06   0.002     1.195716     2.26186
      Asian or Asian British  |    1.59823   .0979637     7.65   0.000      1.41731    1.802245
                       Black  |    1.69624   .1468454     6.10   0.000     1.431521    2.009911
                       Other  |   1.378795   .1814325     2.44   0.015      1.06535    1.784463
                              |
                          imd |
                           2  |   1.201182   .0649184     3.39   0.001     1.080452    1.335403
                           3  |   1.252897   .0676148     4.18   0.000     1.127143    1.392682
                           4  |   1.536793   .0809335     8.16   0.000     1.386078    1.703896
             5 most deprived  |   1.692462   .0915487     9.73   0.000     1.522214    1.881751
                              |
           1.htdiag_or_highbp |   .9788681   .0371803    -0.56   0.574     .9086425    1.054521
1.chronic_respiratory_disease |   1.786103   .0696897    14.87   0.000     1.654606    1.928051
                              |
                    asthmacat |
                 Yes, no OCS  |   1.027975   .0487432     0.58   0.561     .9367445     1.12809
                Yes with OCS  |   1.214151   .1002749     2.35   0.019     1.032698    1.427487
                              |
    1.chronic_cardiac_disease |   1.267574   .0439727     6.83   0.000     1.184254    1.356757
                              |
                      diabcat |
         Controlled diabetes  |   1.486362   .0584707    10.07   0.000     1.376068    1.605496
       Uncontrolled diabetes  |   2.223697   .1083055    16.41   0.000     2.021239    2.446434
  Diabetes, no hba1c measure  |   1.924738   .1444001     8.73   0.000     1.661543    2.229623
                              |
            cancer_exhaem_cat |
                   Last year  |    1.63681   .1801418     4.48   0.000     1.319222    2.030854
               2-5 years ago  |   1.201707   .0917598     2.41   0.016     1.034672    1.395708
                    5+ years  |   1.020195   .0530754     0.38   0.701     .9212972     1.12971
                              |
              cancer_haem_cat |
                   Last year  |   3.202223   .7372094     5.06   0.000      2.03934    5.028211
               2-5 years ago  |   3.363316   .4246297     9.61   0.000     2.626036    4.307593
                    5+ years  |   1.808799   .2143235     5.00   0.000     1.433944    2.281648
                              |
      1.chronic_liver_disease |   1.610178   .1759758     4.36   0.000     1.299709    1.994809
            1.stroke_dementia |   1.750035    .074496    13.15   0.000      1.60995    1.902308
                1.other_neuro |   2.399781   .1648859    12.74   0.000     2.097426    2.745722
     1.chronic_kidney_disease |   1.730189   .0623458    15.21   0.000     1.612209    1.856803
           1.organ_transplant |   4.567968    .727412     9.54   0.000     3.343306    6.241228
                     1.spleen |   1.413822   .3347621     1.46   0.144     .8888915    2.248747
           1.ra_sle_psoriasis |   1.161539   .0631122     2.76   0.006       1.0442    1.292063
    1.other_immunosuppression |   1.665683   .3072795     2.77   0.006     1.160288    2.391218
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_multivariate_cox_models_`outcome'_MAINFULLYADJMODEL_agespline_bmicat_CCeth, repl
> ace
(note: file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster not f
> ound)
file ./output/models/an_multivariate_cox_models_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_CCeth.ster saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"

.  
. 
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/an_multivariable_cox_models_cpnsdeath.log
  log type:  text
 closed on:   1 May 2020, 20:38:49
--------------------------------------------------------------------------------------------------------------------
