--------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/kbadhoc_BMICC_an_multivariable_cox_
> models_cpnsdeath.log
  log type:  text
 opened on:  30 Apr 2020, 20:25:40

. 
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. replace obese4cat = . if bmicat>=.
(3,763,484 real changes made, 3,763,484 to missing)

. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id)
>  

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. *Age spline model (not adj ethnicity)
. basecoxmodel, age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0)
   1:   3190.47 /        1 =    3190.4670

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   13,544,053                  Number of obs    =  13,544,053
No. of failures =        5,174
Time at risk    =   1136136212
                                                LR chi2(35)      =    15726.59
Log likelihood  =    -60449.09                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------------------
                       _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------------------+----------------------------------------------------------------
                     age1 |   1.118542   .0320627     3.91   0.000     1.057432    1.183182
                     age2 |   .9824264   .0618408    -0.28   0.778     .8683992    1.111426
                     age3 |   1.008446   .1477172     0.06   0.954     .7567787    1.343807
                   1.male |   2.056074   .0622184    23.82   0.000     1.937674    2.181709
                          |
                obese4cat |
       Obese I (30-34.9)  |   1.318964   .0463008     7.89   0.000     1.231268    1.412907
      Obese II (35-39.9)  |   1.639588   .0838919     9.66   0.000     1.483138     1.81254
         Obese III (40+)  |   2.394674   .1612663    12.97   0.000     2.098569    2.732559
                          |
             smoke_nomiss |
                  Former  |   1.249996   .0405033     6.89   0.000      1.17308    1.331956
                 Current  |   .9145617   .0554475    -1.47   0.141     .8120951    1.029957
                          |
                      imd |
                       2  |   1.131667   .0535922     2.61   0.009     1.031356    1.241735
                       3  |   1.226907   .0577711     4.34   0.000     1.118745    1.345525
                       4  |   1.487169   .0688875     8.57   0.000       1.3581    1.628505
         5 most deprived  |   1.727014   .0819716    11.51   0.000     1.573599    1.895386
                          |
       1.htdiag_or_highbp |   .9442415   .0322516    -1.68   0.093      .883099    1.009617
1.chronic_respiratory_d~e |   1.731379   .0606907    15.66   0.000     1.616422    1.854512
                          |
                asthmacat |
             Yes, no OCS  |   1.102866   .0463821     2.33   0.020     1.015605    1.197625
            Yes with OCS  |   1.206711   .0921072     2.46   0.014     1.039039     1.40144
                          |
1.chronic_cardiac_disease |    1.26083   .0389366     7.51   0.000      1.18678    1.339501
                          |
                  diabcat |
     Controlled diabetes  |   1.475413   .0515465    11.13   0.000     1.377765    1.579982
   Uncontrolled diabetes  |    2.30787   .0988592    19.52   0.000      2.12202    2.509997
Diabetes, no hba1c mea..  |   1.833955   .1278098     8.70   0.000     1.599808    2.102372
                          |
        cancer_exhaem_cat |
               Last year  |   1.470143   .1505038     3.76   0.000     1.202871    1.796801
           2-5 years ago  |   1.190369   .0803561     2.58   0.010     1.042849    1.358758
                5+ years  |   .9547667   .0449918    -0.98   0.326     .8705342     1.04715
                          |
          cancer_haem_cat |
               Last year  |   3.643447   .7039177     6.69   0.000     2.494936    5.320659
           2-5 years ago  |   2.982149   .3545944     9.19   0.000       2.3622    3.764801
                5+ years  |   1.866225   .1949114     5.97   0.000     1.520769    2.290155
                          |
  1.chronic_liver_disease |    1.58104   .1595533     4.54   0.000     1.297306    1.926829
        1.stroke_dementia |   1.772989   .0671264    15.13   0.000     1.646186    1.909559
            1.other_neuro |   2.365616   .1473831    13.82   0.000      2.09369    2.672858
 1.chronic_kidney_disease |   1.678168   .0541128    16.06   0.000     1.575391    1.787651
       1.organ_transplant |   4.400285   .6604159     9.87   0.000     3.278902    5.905181
                 1.spleen |    1.23467    .284376     0.92   0.360     .7861354    1.939118
       1.ra_sle_psoriasis |   1.195693   .0575642     3.71   0.000     1.088029    1.314011
1.other_immunosuppression |   1.522269   .2800561     2.28   0.022     1.061435    2.183179
-------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/kbadhoc_BMICC_an_multivariable_cox_models_, replace
(note: file ./output/models/kbadhoc_BMICC_an_multivariable_cox_models_.ster not found)
file ./output/models/kbadhoc_BMICC_an_multivariable_cox_models_.ster saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING AGE SPLINE MODEL DID NOT FIT (OUTCOME `outcome')"

.  
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/kbadhoc_BMICC_an_multivariable_cox_
> models_cpnsdeath.log
  log type:  text
 closed on:  30 Apr 2020, 21:28:56
--------------------------------------------------------------------------------------------
