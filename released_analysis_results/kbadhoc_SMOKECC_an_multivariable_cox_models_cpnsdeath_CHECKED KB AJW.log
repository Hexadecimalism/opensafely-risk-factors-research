--------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/kbadhoc_SMOKECC_an_multivariable_co
> x_models_cpnsdeath.log
  log type:  text
 opened on:  30 Apr 2020, 20:27:43

. 
. use cr_create_analysis_dataset, clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke                                 ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
. 
. stset stime_`outcome', fail(`outcome') enter(enter_date) origin(enter_date) id(patient_id)
>  

                id:  patient_id
     failure event:  cpnsdeath != 0 & cpnsdeath < .
obs. time interval:  (stime_cpnsdeath[_n-1], stime_cpnsdeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
   17420594  total observations
        466  observations end on or before enter()
------------------------------------------------------------------------------
   17420128  observations remaining, representing
   17420128  subjects
      5,707  failures in single-failure-per-subject data
 1.4615e+09  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        84

. 
. *Age spline model (not adj ethnicity)
. basecoxmodel, age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0)
   1:   3039.50 /        1 =    3039.4970

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   16,559,800                  Number of obs    =  16,559,800
No. of failures =        5,644
Time at risk    =   1389280249
                                                LR chi2(35)      =    18018.19
Log likelihood  =   -66645.241                  Prob > chi2      =      0.0000

-------------------------------------------------------------------------------------------
                       _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------------------+----------------------------------------------------------------
                     age1 |   1.130485   .0286127     4.85   0.000     1.075774    1.187979
                     age2 |   .9601128   .0538403    -0.73   0.468     .8601801    1.071655
                     age3 |   1.060176   .1389011     0.45   0.656       .82008    1.370566
                   1.male |   1.985433   .0572062    23.80   0.000     1.876418    2.100781
                          |
                obese4cat |
       Obese I (30-34.9)  |   1.267574   .0438716     6.85   0.000     1.184439    1.356544
      Obese II (35-39.9)  |   1.565155   .0794349     8.83   0.000     1.416958    1.728851
         Obese III (40+)  |   2.268501   .1518142    12.24   0.000     1.989639    2.586448
                          |
                    smoke |
                  Former  |   1.255281   .0387076     7.37   0.000     1.181663    1.333486
                 Current  |   .8766979    .050716    -2.27   0.023     .7827244    .9819537
                          |
                      imd |
                       2  |   1.141005   .0514215     2.93   0.003     1.044544    1.246375
                       3  |   1.221568   .0549694     4.45   0.000     1.118445      1.3342
                       4  |   1.492997   .0660777     9.06   0.000     1.368945     1.62829
         5 most deprived  |   1.744455   .0791177    12.27   0.000      1.59608    1.906624
                          |
       1.htdiag_or_highbp |   .9530593   .0309507    -1.48   0.139     .8942872    1.015694
1.chronic_respiratory_d~e |   1.778137   .0603154    16.97   0.000     1.663765    1.900371
                          |
                asthmacat |
             Yes, no OCS  |    1.10557   .0449713     2.47   0.014      1.02085    1.197321
            Yes with OCS  |    1.22568   .0904691     2.76   0.006     1.060593    1.416464
                          |
1.chronic_cardiac_disease |   1.264137    .037795     7.84   0.000     1.192188    1.340427
                          |
                  diabcat |
     Controlled diabetes  |   1.507965   .0512156    12.09   0.000     1.410853    1.611762
   Uncontrolled diabetes  |   2.363182   .0988703    20.56   0.000     2.177132    2.565131
Diabetes, no hba1c mea..  |   1.849548   .1246102     9.13   0.000     1.620754    2.110638
                          |
        cancer_exhaem_cat |
               Last year  |    1.49472   .1471195     4.08   0.000     1.232479     1.81276
           2-5 years ago  |   1.181859   .0775898     2.55   0.011     1.039164     1.34415
                5+ years  |   .9643662   .0436486    -0.80   0.423     .8825012    1.053825
                          |
          cancer_haem_cat |
               Last year  |   3.425267   .6615662     6.37   0.000     2.345799    5.001474
           2-5 years ago  |   3.074729    .349078     9.89   0.000     2.461324    3.841005
                5+ years  |   1.857503   .1871673     6.15   0.000     1.524614    2.263075
                          |
  1.chronic_liver_disease |   1.611642   .1566922     4.91   0.000     1.332019    1.949965
        1.stroke_dementia |   1.799219   .0655502    16.12   0.000     1.675223    1.932393
            1.other_neuro |   2.399692   .1424336    14.75   0.000     2.136153    2.695743
 1.chronic_kidney_disease |   1.683474   .0521867    16.80   0.000     1.584236     1.78893
       1.organ_transplant |   4.248583   .6239885     9.85   0.000     3.185872    5.665783
                 1.spleen |   1.394681   .2920927     1.59   0.112     .9251344    2.102543
       1.ra_sle_psoriasis |   1.218152   .0561934     4.28   0.000     1.112847    1.333422
1.other_immunosuppression |   1.682264   .2826707     3.10   0.002     1.210227    2.338415
-------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/kbadhoc_SMOKECC_an_multivariable_cox_models_, replace
(note: file ./output/models/kbadhoc_SMOKECC_an_multivariable_cox_models_.ster not found)
file ./output/models/kbadhoc_SMOKECC_an_multivariable_cox_models_.ster saved
. *estat concordance /*c-statistic*/
. }

. else di "WARNING AGE SPLINE MODEL DID NOT FIT (OUTCOME `outcome')"

.  
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/kbadhoc_SMOKECC_an_multivariable_co
> x_models_cpnsdeath.log
  log type:  text
 closed on:  30 Apr 2020, 21:27:22
--------------------------------------------------------------------------------------------
