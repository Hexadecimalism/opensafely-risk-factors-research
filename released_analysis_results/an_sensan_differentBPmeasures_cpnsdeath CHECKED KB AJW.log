--------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/an_sensan_differentBPmeasures_cpnsdeath.log
  log type:  text
 opened on:   1 May 2020, 18:33:00

. 
. use "cr_create_analysis_dataset_STSET_cpnsdeath.dta", clear
(Analysis dataset for the poor outcomes in Covid project)

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , age(string) bp(string) [ethnicity(real 0) if(string)] 
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `age'                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         `bp'                                                    ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.chronic_kidney_disease                ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression                       ///
>                         `if'                                                    ///
>                         , strata(stp)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. 
.  
. *Model with coded hypertension 
. basecoxmodel, age("age1 age2 age3") bp("i.hypertension") ethnicity(1)
   1:   2130.65 /        1 =    2130.6520

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,715,040                  Number of obs    =  12,715,040
No. of failures =        4,221
Time at risk    =   1066826984
                                                LR chi2(39)      =    13765.79
Log likelihood  =   -48754.719                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.117509   .0305018     4.07   0.000     1.059298    1.178919
                         age2 |   .9852019   .0600684    -0.24   0.807     .8742325    1.110257
                         age3 |   .9954192   .1423357    -0.03   0.974     .7521285    1.317407
                       1.male |   1.922646   .0639781    19.64   0.000     1.801253     2.05222
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.274112   .0505169     6.11   0.000     1.178851    1.377072
          Obese II (35-39.9)  |   1.589692   .0918858     8.02   0.000     1.419426    1.780383
             Obese III (40+)  |   2.235556   .1729545    10.40   0.000     1.921021    2.601591
                              |
                 smoke_nomiss |
                      Former  |    1.32392   .0482177     7.70   0.000     1.232709    1.421879
                     Current  |   .9398704   .0624977    -0.93   0.351     .8250237    1.070704
                              |
                    ethnicity |
                       Mixed  |    1.63959   .2666299     3.04   0.002     1.192101    2.255057
      Asian or Asian British  |   1.593823   .0977384     7.60   0.000     1.413324    1.797374
                       Black  |   1.685349   .1459202     6.03   0.000     1.422301    1.997047
                       Other  |   1.380569   .1816661     2.45   0.014     1.066719    1.786758
                              |
                          imd |
                           2  |   1.200763   .0648955     3.39   0.001     1.080075    1.334936
                           3  |   1.251263   .0675277     4.15   0.000     1.125671    1.390869
                           4  |   1.533622   .0807707     8.12   0.000     1.383211    1.700389
             5 most deprived  |   1.688605   .0913398     9.69   0.000     1.518745    1.877462
                              |
               1.hypertension |   1.077963   .0391834     2.07   0.039     1.003837    1.157563
1.chronic_respiratory_disease |    1.78945   .0698046    14.92   0.000     1.657734     1.93163
                              |
                    asthmacat |
                 Yes, no OCS  |   1.027033   .0486996     0.56   0.574      .935885    1.127059
                Yes with OCS  |    1.21321   .1001961     2.34   0.019     1.031899    1.426378
                              |
    1.chronic_cardiac_disease |   1.260101   .0437747     6.66   0.000     1.177159    1.348886
                              |
                      diabcat |
         Controlled diabetes  |   1.467997   .0580128     9.71   0.000     1.358585    1.586219
       Uncontrolled diabetes  |   2.193942   .1071941    16.08   0.000     1.993592    2.414428
  Diabetes, no hba1c measure  |   1.909836   .1433373     8.62   0.000     1.648586    2.212486
                              |
            cancer_exhaem_cat |
                   Last year  |    1.63607   .1800596     4.47   0.000     1.318627    2.029934
               2-5 years ago  |   1.200552   .0916727     2.39   0.017     1.033676    1.394369
                    5+ years  |   1.019498   .0530395     0.37   0.711     .9206666    1.128938
                              |
              cancer_haem_cat |
                   Last year  |   3.202177   .7371973     5.06   0.000     2.039313    5.028134
               2-5 years ago  |   3.368165   .4252345     9.62   0.000     2.629833    4.313784
                    5+ years  |   1.812865    .214803     5.02   0.000      1.43717    2.286772
                              |
      1.chronic_liver_disease |   1.606875   .1755568     4.34   0.000     1.297136    1.990577
            1.stroke_dementia |   1.739125   .0740811    12.99   0.000     1.599824    1.890554
                1.other_neuro |    2.40138   .1649986    12.75   0.000     2.098818    2.747558
     1.chronic_kidney_disease |   1.717094   .0619385    14.99   0.000     1.599889    1.842886
           1.organ_transplant |   4.497156   .7161187     9.44   0.000     3.291503    6.144431
                     1.spleen |   1.415152   .3350785     1.47   0.143     .8897261    2.250867
           1.ra_sle_psoriasis |   1.159618   .0630103     2.73   0.006     1.042469    1.289932
    1.other_immunosuppression |   1.666582   .3074443     2.77   0.006     1.160915    2.392505
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_HTN, rep
> lace
(note: file ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_HTN.ster not 
> found)
file ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_HTN.ster saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC MODEL (excluding ethnicity) DID NOT FIT (OUTCOME `outcome')"

.  
. 
. 
. *Model with categorised bp
. basecoxmodel, age("age1 age2 age3") bp("i.bpcat_nomiss") ethnicity(1)
   1:   2148.75 /        1 =    2148.7520

. if _rc==0{
. estimates

--------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects =   12,715,040                  Number of obs    =  12,715,040
No. of failures =        4,221
Time at risk    =   1066826984
                                                LR chi2(41)      =    13871.77
Log likelihood  =   -48701.732                  Prob > chi2      =      0.0000

-----------------------------------------------------------------------------------------------
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                         age1 |   1.123712   .0306052     4.28   0.000       1.0653    1.185327
                         age2 |   .9892808   .0601701    -0.18   0.859     .8781077    1.114529
                         age3 |   .9737848    .138917    -0.19   0.852     .7362636    1.287931
                       1.male |    1.91826   .0638106    19.58   0.000     1.797183    2.047493
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.313925    .052028     6.89   0.000     1.215809    1.419959
          Obese II (35-39.9)  |   1.658302   .0956714     8.77   0.000     1.481003    1.856827
             Obese III (40+)  |   2.349699   .1813452    11.07   0.000     2.019846     2.73342
                              |
                 smoke_nomiss |
                      Former  |   1.325389    .048283     7.73   0.000     1.234055    1.423482
                     Current  |    .933304   .0620565    -1.04   0.299     .8192674    1.063214
                              |
                    ethnicity |
                       Mixed  |   1.650662   .2684283     3.08   0.002     1.200154     2.27028
      Asian or Asian British  |    1.58612    .097151     7.53   0.000     1.406693    1.788433
                       Black  |   1.720989   .1489516     6.27   0.000     1.452468    2.039152
                       Other  |   1.356867   .1785629     2.32   0.020     1.048382    1.756123
                              |
                          imd |
                           2  |   1.200515   .0648806     3.38   0.001     1.079855    1.334658
                           3  |   1.249893   .0674497     4.13   0.000     1.124445    1.389336
                           4  |   1.532233   .0806739     8.10   0.000        1.382    1.698797
             5 most deprived  |   1.683163   .0910399     9.63   0.000      1.51386    1.871399
                              |
                 bpcat_nomiss |
                    Elevated  |   .7472429   .0377401    -5.77   0.000      .676817     .824997
               High, stage I  |   .6633613   .0289767    -9.40   0.000     .6089312    .7226567
              High, stage II  |   .6420353   .0285888    -9.95   0.000     .5883777    .7005862
                              |
1.chronic_respiratory_disease |   1.760712   .0687404    14.49   0.000     1.631008    1.900729
                              |
                    asthmacat |
                 Yes, no OCS  |   1.030497   .0488615     0.63   0.526      .939045    1.130854
                Yes with OCS  |   1.220989   .1008303     2.42   0.016     1.038529    1.435505
                              |
    1.chronic_cardiac_disease |   1.226148   .0427244     5.85   0.000     1.145205    1.312812
                              |
                      diabcat |
         Controlled diabetes  |   1.477601    .057998     9.95   0.000      1.36819    1.595762
       Uncontrolled diabetes  |   2.223061   .1080371    16.44   0.000     2.021084    2.445222
  Diabetes, no hba1c measure  |   1.918318   .1438572     8.69   0.000     1.656105    2.222047
                              |
            cancer_exhaem_cat |
                   Last year  |   1.616608   .1779322     4.36   0.000     1.302918    2.005822
               2-5 years ago  |   1.197755   .0914598     2.36   0.018     1.031266    1.391121
                    5+ years  |   1.019096   .0530184     0.36   0.716     .9203042    1.128493
                              |
              cancer_haem_cat |
                   Last year  |   3.158217   .7270957     5.00   0.000     2.011293    4.959165
               2-5 years ago  |   3.305539   .4173655     9.47   0.000     2.580878    4.233671
                    5+ years  |   1.789842   .2120895     4.91   0.000     1.418896    2.257766
                              |
      1.chronic_liver_disease |   1.598645   .1747159     4.29   0.000       1.2904    1.980523
            1.stroke_dementia |   1.730544     .07359    12.90   0.000     1.592157    1.880959
                1.other_neuro |   2.346595   .1612681    12.41   0.000     2.050879    2.684951
     1.chronic_kidney_disease |   1.715186   .0617135    14.99   0.000     1.598396    1.840509
           1.organ_transplant |   4.622345   .7356644     9.62   0.000     3.383688    6.314434
                     1.spleen |   1.400338   .3315699     1.42   0.155     .8804139    2.227302
           1.ra_sle_psoriasis |   1.161395   .0631051     2.75   0.006      1.04407    1.291905
    1.other_immunosuppression |   1.651851   .3047494     2.72   0.007     1.150623    2.371422
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
. estimates save ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_BPCAT, r
> eplace
(note: file ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_BPCAT.ster no
> t found)
file ./output/models/an_sensan_differentBPmeasures_cpnsdeath_MAINFULLYADJMODEL_agespline_bmicat_BPCAT.ster saved
. *estat concordance /*c-statistic*/
.  }

.  else di "WARNING CC MODEL (excluding ethnicity) DID NOT FIT (OUTCOME `outcome')"

.  
. 
. 
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\alex-tmp-repo-2\analysis\output/an_sensan_differentBPmeasures_cpnsdeath.log
  log type:  text
 closed on:   1 May 2020, 19:44:36
--------------------------------------------------------------------------------------------------------------------
